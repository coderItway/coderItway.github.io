---
title: Nuxtjsæ€»ç»“
author: Itway
date: 2023/03/05 17:38
categories:
 - vueçŸ¥è¯†é›†
tags:
 - Nuxtjs
---

# {{ $frontmatter.title }}

## å‰è¨€

ä½œä¸ºä¸€ä½ Vuerï¼ˆvueå¼€å‘è€…ï¼‰ï¼Œå¦‚æœè¿˜ä¸ä¼šè¿™ä¸ªæ¡†æ¶ï¼Œé‚£ä¹ˆä½ çš„ `Vue` æŠ€æœ¯æ ˆè¿˜æ²¡è¢«ç‚¹äº®ã€‚

> å‚è€ƒç½‘ç«™ï¼šhttps://www.cnblogs.com/chanwahfung/p/12899714.html

### Nuxt.js æ˜¯ä»€ä¹ˆ

Nuxt.js å®˜æ–¹ä»‹ç»ï¼š

> Nuxt.js æ˜¯ä¸€ä¸ªåŸºäº Vue.js çš„é€šç”¨åº”ç”¨æ¡†æ¶ã€‚
> é€šè¿‡å¯¹å®¢æˆ·ç«¯/æœåŠ¡ç«¯åŸºç¡€æ¶æ„çš„æŠ½è±¡ç»„ç»‡ï¼ŒNuxt.js ä¸»è¦å…³æ³¨çš„æ˜¯åº”ç”¨çš„ UIæ¸²æŸ“ã€‚
> æˆ‘ä»¬çš„ç›®æ ‡æ˜¯åˆ›å»ºä¸€ä¸ªçµæ´»çš„åº”ç”¨æ¡†æ¶ï¼Œä½ å¯ä»¥åŸºäºå®ƒåˆå§‹åŒ–æ–°é¡¹ç›®çš„åŸºç¡€ç»“æ„ä»£ç ï¼Œæˆ–è€…åœ¨å·²æœ‰ Node.js é¡¹ç›®ä¸­ä½¿ç”¨ Nuxt.jsã€‚
> Nuxt.js é¢„è®¾äº†åˆ©ç”¨ Vue.js å¼€å‘æœåŠ¡ç«¯æ¸²æŸ“çš„åº”ç”¨æ‰€éœ€è¦çš„å„ç§é…ç½®ã€‚

å¦‚æœä½ ç†Ÿæ‚‰ `Vue.js` çš„ä½¿ç”¨ï¼Œé‚£ä½ å¾ˆå¿«å°±å¯ä»¥ä¸Šæ‰‹ `Nuxt.js`ã€‚å¼€å‘ä½“éªŒä¹Ÿå’Œ `Vue.js` æ²¡å¤ªå¤§åŒºåˆ«ï¼Œç›¸å½“äºä¸º `Vue.js` æ‰©å±•äº†ä¸€äº›é…ç½®ã€‚å½“ç„¶ä½ å¯¹ `Node.js` æœ‰åŸºç¡€ï¼Œé‚£å°±å†å¥½ä¸è¿‡äº†ã€‚

### Nuxt.js è§£å†³ä»€ä¹ˆé—®é¢˜

ç°åœ¨ `Vue.js` å¤§å¤šæ•°ç”¨äºå•é¡µé¢åº”ç”¨ï¼Œéšç€æŠ€æœ¯çš„å‘å±•ï¼Œå•é¡µé¢åº”ç”¨å·²ä¸è¶³ä»¥æ»¡è¶³éœ€æ±‚ã€‚å¹¶ä¸”ä¸€äº›ç¼ºç‚¹ä¹Ÿæˆä¸ºå•é¡µé¢åº”ç”¨çš„é€šç—…ï¼Œå•é¡µé¢åº”ç”¨åœ¨è®¿é—®æ—¶ä¼šå°†æ‰€æœ‰çš„æ–‡ä»¶è¿›è¡ŒåŠ è½½ï¼Œé¦–å±è®¿é—®éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„ç™½å±ï¼Œå¦å¤–ä¸€ç‚¹æ˜¯æ€»æ‰€å‘¨çŸ¥çš„ `SEO` ä¼˜åŒ–é—®é¢˜ã€‚

`Nuxt.js` çš„å‡ºç°æ­£å¥½æ¥è§£å†³è¿™äº›é—®é¢˜ï¼Œå¦‚æœä½ çš„ç½‘ç«™æ˜¯åå‘ç¤¾åŒºéœ€è¦æœç´¢å¼•æ“æä¾›æµé‡çš„é¡¹ç›®ï¼Œé‚£å°±å†åˆé€‚ä¸è¿‡äº†ã€‚

### æˆ‘çš„ç¬¬ä¸€ä¸ª Nuxt.js é¡¹ç›®

æˆ‘åœ¨ç©ºé—²çš„æ—¶é—´ä¹Ÿç”¨ `Nuxt.js` ä»¿æ˜é‡‘ `web` ç½‘ç«™ï¼š

`nuxt-juejin-project` æ˜¯ä¸€ä¸ªä½¿ç”¨ `Nuxt.js` ä»¿å†™æ˜é‡‘çš„å­¦ä¹ é¡¹ç›®ï¼Œä¸»è¦ä½¿ç”¨ ï¼š `nuxt` + `koa` + `vuex` + `axios` + `element-ui`ã€‚è¯¥é¡¹ç›®æ‰€æœ‰æ•°æ®ä¸æ˜é‡‘åŒæ­¥ï¼Œå› ä¸ºæ¥å£éƒ½æ˜¯é€šè¿‡ `koa` ä½œä¸ºä¸­é—´å±‚è½¬å‘ã€‚ä¸»è¦é¡µé¢æ•°æ®é€šè¿‡æœåŠ¡ç«¯æ¸²æŸ“å®Œæˆã€‚

åœ¨é¡¹ç›®å®Œæˆåçš„å‡ å¤©ï¼Œæˆ‘å°†è®°å½•çš„ç¬”è®°æ•´ç†ä¸€ä¸‹ï¼Œå¹¶åŠ å…¥ä¸€äº›å¸¸ç”¨çš„æŠ€æœ¯ç‚¹ï¼Œæœ€åæœ‰äº†è¿™ç¯‡æ–‡ç« ï¼Œå¸Œæœ›èƒ½å¤Ÿå¸®åˆ°æ­£åœ¨å­¦ä¹ çš„å°ä¼™ä¼´ã€‚

é¡¹ç›®ä»‹ç»é‡Œæœ‰éƒ¨åˆ†æˆªå›¾ï¼Œå¦‚æœjioå¾—å¯ä»¥ï¼Œè¯·æ¥ä¸ª starğŸ˜œ~

é¡¹ç›®åœ°å€ï¼š[https://github.com/ChanWahFung/nuxt-juejin-project](https://github.com/ChanWahFung/nuxt-juejin-project)

## åŸºç¡€åº”ç”¨ä¸é…ç½®

é¡¹ç›®çš„æ­å»ºå‚ç…§å®˜ç½‘æŒ‡å¼•ï¼Œè·‘ä¸ªé¡¹ç›®ç›¸ä¿¡éš¾ä¸åˆ°ä½ ä»¬ï¼Œè¿™é‡Œä¸èµ˜è¿°äº†ã€‚

ğŸƒâ€â™€ï¸è·‘èµ·æ¥ [https://www.nuxtjs.cn/guide/installation](https://www.nuxtjs.cn/guide/installation)

å…³äºé¡¹ç›®çš„é…ç½®ï¼Œæˆ‘é€‰æ‹©çš„æ˜¯ï¼š

* æœåŠ¡ç«¯ï¼šKoa
* UIæ¡†æ¶ï¼šElement UI
* æµ‹è¯•æ¡†æ¶ï¼šNone
* Nuxtæ¨¡å¼ï¼šUniversal
* ä½¿ç”¨é›†æˆçš„ Axios
* ä½¿ç”¨ EsLint

### context

> context æ˜¯ä» Nuxt é¢å¤–æä¾›çš„å¯¹è±¡ï¼Œåœ¨"asyncData"ã€"plugins"ã€"middlewares"ã€"modules" å’Œ "store/nuxtServerInit" ç­‰ç‰¹æ®Šçš„ Nuxt ç”Ÿå‘½å‘¨æœŸåŒºåŸŸä¸­éƒ½ä¼šä½¿ç”¨åˆ° contextã€‚

æ‰€ä»¥ï¼Œæƒ³è¦ä½¿ç”¨ `Nuxt.js`ï¼Œæˆ‘ä»¬å¿…é¡»è¦ç†ŸçŸ¥è¯¥å¯¹è±¡çš„æœ‰å“ªäº›å¯ç”¨å±æ€§ã€‚

`context` å®˜æ–¹æ–‡æ¡£æè¿°æˆ³è¿™é‡Œ [https://www.nuxtjs.cn/api/context](https://www.nuxtjs.cn/api/context)

ä¸‹é¢æˆ‘åˆ—ä¸¾å‡ ä¸ªåœ¨å®é™…åº”ç”¨ä¸­æ¯”è¾ƒé‡è¦ä¸”å¸¸ç”¨çš„å±æ€§ï¼š

#### app

`app` æ˜¯ `context` ä¸­æœ€é‡è¦çš„å±æ€§ï¼Œå°±åƒæˆ‘ä»¬ `Vue` ä¸­çš„ `this`ï¼Œå…¨å±€æ–¹æ³•å’Œå±æ€§éƒ½ä¼šæŒ‚è½½åˆ°å®ƒé‡Œé¢ã€‚å› ä¸ºæœåŠ¡ç«¯æ¸²æŸ“çš„ç‰¹æ®Šæ€§ï¼Œå¾ˆå¤š `Nuxt`æä¾›çš„ç”Ÿå‘½å‘¨æœŸéƒ½æ˜¯è¿è¡Œåœ¨æœåŠ¡ç«¯ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬ä¼šå…ˆäº `Vue` å®ä¾‹çš„åˆ›å»ºã€‚å› æ­¤åœ¨è¿™äº›ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œæˆ‘ä»¬æ— æ³•é€šè¿‡ `this` å»è·å–å®ä¾‹ä¸Šçš„æ–¹æ³•å’Œå±æ€§ã€‚ä½¿ç”¨ `app` å¯ä»¥æ¥å¼¥è¡¥è¿™ç‚¹ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šæŠŠå…¨å±€çš„æ–¹æ³•åŒæ—¶æ³¨å…¥åˆ° `this` å’Œ `app` ä¸­ï¼Œåœ¨æœåŠ¡ç«¯çš„ç”Ÿå‘½å‘¨æœŸä¸­ä½¿ç”¨ `app` å»è®¿é—®è¯¥æ–¹æ³•ï¼Œè€Œåœ¨å®¢æˆ·ç«¯ä¸­ä½¿ç”¨ `this`ï¼Œä¿è¯æ–¹æ³•çš„å…±ç”¨ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š

å‡è®¾ `$axios` å·²è¢«åŒæ—¶æ³¨å…¥ï¼Œä¸€èˆ¬ä¸»è¦æ•°æ®é€šè¿‡ `asyncData` (è¯¥ç”Ÿå‘½å‘¨æœŸå‘èµ·è¯·æ±‚ï¼Œå°†è·å–åˆ°çš„æ•°æ®äº¤ç»™æœåŠ¡ç«¯æ‹¼æ¥æˆhtmlè¿”å›) å»æå‰è¯·æ±‚åšæœåŠ¡ç«¯æ¸²æŸ“ï¼Œè€Œæ¬¡è¦æ•°æ®é€šè¿‡å®¢æˆ·ç«¯çš„ `mounted` å»è¯·æ±‚ã€‚

```js
export default {
  async asyncData({ app }) {
    // åˆ—è¡¨æ•°æ®
    let list = await app.$axios.getIndexList({
      pageNum: 1,
      pageSize: 20
    }).then(res => res.s === 1 ? res.d : [])
    return {
      list
    }
  },
  data() {
    return {
      list: [],
      categories: []
    }
  },
  async mounted() {
    // åˆ†ç±»
    let res = await this.$axios.getCategories()
    if (res.s  === 1) {
      this.categories = res.d
    }
  }
}
```

#### store

`store` æ˜¯ `Vuex.Store` å®ä¾‹ï¼Œåœ¨è¿è¡Œæ—¶ `Nuxt.js` ä¼šå°è¯•æ‰¾åˆ°æ˜¯åº”ç”¨æ ¹ç›®å½•ä¸‹çš„ `store` ç›®å½•ï¼Œå¦‚æœè¯¥ç›®å½•å­˜åœ¨ï¼Œå®ƒä¼šå°†æ¨¡å—æ–‡ä»¶åŠ åˆ°æ„å»ºé…ç½®ä¸­ã€‚

æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦åœ¨æ ¹ç›®å½•çš„ `store` åˆ›å»ºæ¨¡å—jsæ–‡ä»¶ï¼Œå³å¯ä½¿ç”¨ã€‚

`/store/index.js` :

```js
export const state = () => ({
  list: []
})

export const mutations = {
  updateList(state, payload){
    state.list = payload
  }
}
```

è€Œä¸” `Nuxt.js` ä¼šå¾ˆè´´å¿ƒçš„å¸®æˆ‘ä»¬å°† `store` åŒæ—¶æ³¨å…¥ï¼Œæœ€åæˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶è¿™æ ·ä½¿ç”¨ï¼šï¼š

```js
export default {
  async asyncData({ app, store }) {
    let list = await app.$axios.getIndexList({
      pageNum: 1,
      pageSize: 20
    }).then(res => res.s === 1 ? res.d : [])
    // æœåŠ¡ç«¯ä½¿ç”¨
    store.commit('updateList', list)
    return {
      list
    }
  },
  methods: {
    updateList(list) {
      // å®¢æˆ·ç«¯ä½¿ç”¨ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è¾…åŠ©å‡½æ•° mapMutations æ¥å®Œæˆ
      this.$store.commit('updateList', list)
    }
  }
}
```

ä¸ºäº†æ˜ç™½ `store` æ³¨å…¥çš„è¿‡ç¨‹ï¼Œæˆ‘ç¿»é˜… `.nuxt/index.js` æºç ï¼ˆ `.nuxt` ç›®å½•æ˜¯ `Nuxt.js` åœ¨æ„å»ºè¿è¡Œæ—¶è‡ªåŠ¨ç”Ÿæˆçš„ï¼‰ï¼Œå¤§æ¦‚çŸ¥é“äº†æµç¨‹ã€‚é¦–å…ˆåœ¨ `.nuxt/store.js` ä¸­ï¼Œå¯¹ `store` æ¨¡å—æ–‡ä»¶åšå‡ºä¸€ç³»åˆ—çš„å¤„ç†ï¼Œå¹¶æš´éœ² `createStore` æ–¹æ³•ã€‚ç„¶ååœ¨ `.nuxt/index.js` ä¸­ï¼Œ `createApp`æ–¹æ³•ä¼šå¯¹å…¶åŒæ—¶æ³¨å…¥:

```js
import { createStore } from './store.js'

async function createApp (ssrContext) {
  const store = createStore(ssrContext)
  // ...

  // here we inject the router and store to all child components,
  // making them available everywhere as `this.$router` and `this.$store`.

  // æ³¨å…¥åˆ°this
  const app = {
    store
    // ...

  }
  // ...

  // Set context to app.context
  // æ³¨å…¥åˆ°context
  await setContext(app, {
    store
    // ...

  })
  // ...

  return {
    store,
    app,
    router
  }
}
```

é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘è¿˜å‘ç° `Nuxt.js` ä¼šé€šè¿‡ `inject` æ–¹æ³•ä¸ºå…¶æŒ‚è½½ä¸Š `plugin`ï¼ˆ `plugin` æ˜¯æŒ‚è½½å…¨å±€æ–¹æ³•çš„ä¸»è¦é€”å¾„ï¼Œåé¢ä¼šè®²åˆ°ï¼Œä¸çŸ¥é“å¯ä»¥å…ˆå¿½ç•¥ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ `store` é‡Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `this` è®¿é—®åˆ°å…¨å±€æ–¹æ³•ï¼š

```js
export const mutations = {
  updateList(state, payload){
    console.log(this.$axios)
    state.list = payload
  }
}
```

#### paramsã€query

`params` å’Œ `query` åˆ†åˆ«æ˜¯ `route.params` å’Œ `route.query` çš„åˆ«åã€‚å®ƒä»¬éƒ½å¸¦æœ‰è·¯ç”±å‚æ•°çš„å¯¹è±¡ï¼Œä½¿ç”¨æ–¹æ³•ä¹Ÿå¾ˆç®€å•ã€‚è¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œç”¨å°±å®Œäº‹äº†ã€‚

```js
export default {
  async asyncData({ app, params }) {
    let list = await app.$axios.getIndexList({
      id: params.id,
      pageNum: 1,
      pageSize: 20
    }).then(res => res.s === 1 ? res.d : [])
    return {
      list
    }
  }
}
```

#### redirect

è¯¥æ–¹æ³•é‡å®šå‘ç”¨æˆ·è¯·æ±‚åˆ°å¦ä¸€ä¸ªè·¯ç”±ï¼Œé€šå¸¸ä¼šç”¨åœ¨æƒé™éªŒè¯ã€‚ç”¨æ³•ï¼š `redirect(params)`ï¼Œ `params` å‚æ•°åŒ…å« `status`(çŠ¶æ€ç ï¼Œé»˜è®¤ä¸º302)ã€ `path`(è·¯ç”±è·¯å¾„)ã€ `query`(å‚æ•°)ï¼Œå…¶ä¸­ `status` å’Œ `query` æ˜¯å¯é€‰çš„ã€‚å½“ç„¶å¦‚æœä½ åªæ˜¯å•çº¯çš„é‡å®šå‘è·¯ç”±ï¼Œå¯ä»¥ä¼ å…¥è·¯å¾„å­—ç¬¦ä¸²ï¼Œå°±åƒ `redirect('/index')`ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š

å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰ä¸ªè·¯ç”±ä¸­é—´ä»¶ï¼Œç”¨äºéªŒè¯ç™»å½•èº«ä»½ï¼Œé€»è¾‘æ˜¯èº«ä»½æ²¡è¿‡æœŸåˆ™ä¸åšä»»ä½•äº‹æƒ…ï¼Œè‹¥èº«ä»½è¿‡æœŸé‡å®šå‘åˆ°ç™»å½•é¡µã€‚

```js
export default function ({ redirect }) {
  // ...

  if (!token) {
    redirect({
      path: '/login',
      query: {
        isExpires: 1
      }
    })
  }
}
```

#### error

è¯¥æ–¹æ³•è·³è½¬åˆ°é”™è¯¯é¡µã€‚ç”¨æ³•ï¼š `error(params)` ï¼Œ `params` å‚æ•°åº”è¯¥åŒ…å« `statusCode` å’Œ `message` å­—æ®µã€‚åœ¨å®é™…åœºæ™¯ä¸­ï¼Œæ€»æœ‰ä¸€äº›ä¸æŒ‰å¸¸ç†çš„æ“ä½œï¼Œé¡µé¢å› æ­¤æ— æ³•å±•ç¤ºçœŸæ­£æƒ³è¦çš„æ•ˆæœï¼Œä½¿ç”¨è¯¥æ–¹æ³•è¿›è¡Œé”™è¯¯æç¤ºè¿˜æ˜¯æœ‰å¿…è¦çš„ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š

æ ‡ç­¾è¯¦æƒ…é¡µé¢è¯·æ±‚æ•°æ®ä¾èµ–äº `query.name`ï¼Œå½“ `query.name` ä¸å­˜åœ¨æ—¶ï¼Œè¯·æ±‚æ— æ³•è¿”å›å¯ç”¨çš„æ•°æ®ï¼Œæ­¤æ—¶è·³è½¬åˆ°é”™è¯¯é¡µ

```js
export default {
  async asyncData({ app, query, error }) {
    const tagInfo = await app.$api.getTagDetail({
      tagName: encodeURIComponent(query.name)
    }).then(res => {
      if (res.s === 1) {
        return res.d
      } else {
        error({
          statusCode: 404,
          message: 'æ ‡ç­¾ä¸å­˜åœ¨'
        })
        return
      }
    })
    return {
      tagInfo
    }
  }
}
```

### Nuxtå¸¸ç”¨é¡µé¢ç”Ÿå‘½å‘¨æœŸ

#### asyncData

> ä½ å¯èƒ½æƒ³è¦åœ¨æœåŠ¡å™¨ç«¯è·å–å¹¶æ¸²æŸ“æ•°æ®ã€‚Nuxt.jsæ·»åŠ äº†asyncDataæ–¹æ³•ä½¿å¾—ä½ èƒ½å¤Ÿåœ¨æ¸²æŸ“ç»„ä»¶ä¹‹å‰å¼‚æ­¥è·å–æ•°æ®ã€‚

`asyncData` æ˜¯æœ€å¸¸ç”¨æœ€é‡è¦çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒæ—¶ä¹Ÿæ˜¯æœåŠ¡ç«¯æ¸²æŸ“çš„å…³é”®ç‚¹ã€‚è¯¥ç”Ÿå‘½å‘¨æœŸåªé™äºé¡µé¢ç»„ä»¶è°ƒç”¨ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸º `context`ã€‚å®ƒè°ƒç”¨çš„æ—¶æœºåœ¨ç»„ä»¶åˆå§‹åŒ–ä¹‹å‰ï¼Œè¿ä½œåœ¨æœåŠ¡ç«¯ç¯å¢ƒã€‚æ‰€ä»¥åœ¨ `asyncData` ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œæˆ‘ä»¬æ— æ³•é€šè¿‡ `this` å¼•ç”¨å½“å‰çš„ `Vue` å®ä¾‹ï¼Œä¹Ÿæ²¡æœ‰ `window` å¯¹è±¡å’Œ `document` å¯¹è±¡ï¼Œè¿™äº›æ˜¯æˆ‘ä»¬éœ€è¦æ³¨æ„çš„ã€‚

ä¸€èˆ¬åœ¨ `asyncData` ä¼šå¯¹ä¸»è¦é¡µé¢æ•°æ®è¿›è¡Œé¢„å…ˆè¯·æ±‚ï¼Œè·å–åˆ°çš„æ•°æ®ä¼šäº¤ç”±æœåŠ¡ç«¯æ‹¼æ¥æˆ `html` è¿”å›å‰ç«¯æ¸²æŸ“ï¼Œä»¥æ­¤æé«˜é¦–å±åŠ è½½é€Ÿåº¦å’Œè¿›è¡Œ `seo` ä¼˜åŒ–ã€‚

çœ‹ä¸‹å›¾ï¼Œåœ¨è°·æ­Œè°ƒè¯•å·¥å…·ä¸­ï¼Œçœ‹ä¸åˆ°ä¸»è¦æ•°æ®æ¥å£å‘èµ·è¯·æ±‚ï¼Œåªæœ‰è¿”å›çš„ `html` æ–‡æ¡£ï¼Œè¯æ˜æ•°æ®åœ¨æœåŠ¡ç«¯è¢«æ¸²æŸ“ã€‚

![](https://s1.ax1x.com/2020/05/13/YweLG9.png)

æœ€åï¼Œéœ€è¦å°†æ¥å£è·å–åˆ°çš„æ•°æ®è¿”å›ï¼š

```js
export default {
  async asyncData({ app }) {
    let list = await app.$axios.getIndexList({
      pageNum: 1,
      pageSize: 20
    }).then(res => res.s === 1 ? res.d : [])
    // è¿”å›æ•°æ®
    return {
      list
    }
  },
  data() {
    return {
      list: []
    }
  }
}
```

å€¼å¾—ä¸€æçš„æ˜¯ï¼Œ `asyncData` åªåœ¨é¦–å±è¢«æ‰§è¡Œï¼Œå…¶å®ƒæ—¶å€™ç›¸å½“äº `created` æˆ– `mounted` åœ¨å®¢æˆ·ç«¯æ¸²æŸ“é¡µé¢ã€‚

ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿä¸¾ä¸ªä¾‹å­ï¼š

ç°åœ¨æœ‰ä¸¤ä¸ªé¡µé¢ï¼Œåˆ†åˆ«æ˜¯é¦–é¡µå’Œè¯¦æƒ…é¡µï¼Œå®ƒä»¬éƒ½æœ‰è®¾ç½® `asyncData`ã€‚è¿›å…¥é¦–é¡µæ—¶ï¼Œ `asyncData` è¿è¡Œåœ¨æœåŠ¡ç«¯ã€‚æ¸²æŸ“å®Œæˆåï¼Œç‚¹å‡»æ–‡ç« è¿›å…¥è¯¦æƒ…é¡µï¼Œæ­¤æ—¶è¯¦æƒ…é¡µçš„ `asyncData` å¹¶ä¸ä¼šè¿è¡Œåœ¨æœåŠ¡ç«¯ï¼Œè€Œæ˜¯åœ¨å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚è·å–æ•°æ®æ¸²æŸ“ï¼Œå› ä¸ºè¯¦æƒ…é¡µå·²ç»ä¸æ˜¯é¦–å±ã€‚å½“æˆ‘ä»¬åˆ·æ–°è¯¦æƒ…é¡µï¼Œè¿™æ—¶å€™è¯¦æƒ…é¡µçš„ `asyncData` æ‰ä¼šè¿è¡Œåœ¨æœåŠ¡ç«¯ã€‚æ‰€ä»¥ï¼Œä¸è¦èµ°è¿›è¿™ä¸ªè¯¯åŒºï¼ˆè¯¶ï¼Œä¸æ˜¯è¯´æœåŠ¡ç«¯æ¸²æŸ“å—ï¼Œæ€ä¹ˆè¿˜ä¼šå‘èµ·è¯·æ±‚ï¼Ÿï¼‰ã€‚

#### fetch

> fetch æ–¹æ³•ç”¨äºåœ¨æ¸²æŸ“é¡µé¢å‰å¡«å……åº”ç”¨çš„çŠ¶æ€æ ‘ï¼ˆstoreï¼‰æ•°æ®ï¼Œ ä¸ asyncData æ–¹æ³•ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯å®ƒä¸ä¼šè®¾ç½®ç»„ä»¶çš„æ•°æ®ã€‚

æŸ¥çœ‹å®˜æ–¹çš„è¯´æ˜ï¼Œå¯ä»¥å¾—çŸ¥è¯¥ç”Ÿå‘½å‘¨æœŸç”¨äºå¡«å…… `Vuex` çŠ¶æ€æ ‘ï¼Œä¸ `asyncData` åŒæ ·ï¼Œå®ƒåœ¨ç»„ä»¶åˆå§‹åŒ–å‰è°ƒç”¨ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸º `context`ã€‚

ä¸ºäº†è®©è·å–è¿‡ç¨‹å¯ä»¥å¼‚æ­¥ï¼Œä½ éœ€è¦è¿”å›ä¸€ä¸ª `Promise`ï¼Œ `Nuxt.js` ä¼šç­‰è¿™ä¸ª `promise` å®Œæˆåå†æ¸²æŸ“ç»„ä»¶ã€‚

```js
export default {
  fetch ({ store, params }) {
    return axios.get('http://my-api/stars')
    .then((res) => {
      store.commit('setStars', res.data)
    })
  }
}
```

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ async æˆ– await çš„æ¨¡å¼ç®€åŒ–ä»£ç å¦‚ä¸‹ï¼š

```js
export default {
  async fetch ({ store, params }) {
    let { data } = await axios.get('http://my-api/stars')
    store.commit('setStars', data)
  }
}
```

ä½†è¿™å¹¶ä¸æ˜¯è¯´æˆ‘ä»¬åªèƒ½åœ¨ `fetch` ä¸­å¡«å……çŠ¶æ€æ ‘ï¼Œåœ¨ `asyncData` ä¸­åŒæ ·å¯ä»¥ã€‚

#### validate

> Nuxt.js å¯ä»¥è®©ä½ åœ¨åŠ¨æ€è·¯ç”±å¯¹åº”çš„é¡µé¢ç»„ä»¶ä¸­é…ç½®ä¸€ä¸ªæ ¡éªŒæ–¹æ³•ç”¨äºæ ¡éªŒåŠ¨æ€è·¯ç”±å‚æ•°çš„æœ‰æ•ˆæ€§ã€‚

åœ¨éªŒè¯è·¯ç”±å‚æ•°åˆæ³•æ€§æ—¶ï¼Œå®ƒèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸º `context`ã€‚ä¸ä¸Šé¢æœ‰ç‚¹ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè®¿é—®å®ä¾‹ä¸Šçš„æ–¹æ³• `this.methods.xxx`ã€‚

æ‰“å° `this` å¦‚ä¸‹:

![](https://s1.ax1x.com/2020/05/13/YwGPmj.png)

ç”Ÿå‘½å‘¨æœŸå¯ä»¥è¿”å›ä¸€ä¸ª `Boolean`ï¼Œä¸ºçœŸåˆ™è¿›å…¥è·¯ç”±ï¼Œä¸ºå‡åˆ™åœæ­¢æ¸²æŸ“å½“å‰é¡µé¢å¹¶æ˜¾ç¤ºé”™è¯¯é¡µé¢ï¼š

```js
export default {
  validate({ params, query }) {
    return this.methods.validateParam(params.type)
  },
  methods: {
    validateParam(type){
      let typeWhiteList = ['backend', 'frontend', 'android']
      return typeWhiteList.includes(type)
    }
  }
}
```

æˆ–è€…è¿”å›ä¸€ä¸ªPromise:

```js
export default {
  validate({ params, query, store }) {
    return new Promise((resolve) => setTimeout(() => resolve()))
  }
}
```

è¿˜å¯ä»¥åœ¨éªŒè¯å‡½æ•°æ‰§è¡ŒæœŸé—´æŠ›å‡ºé¢„æœŸæˆ–æ„å¤–é”™è¯¯ï¼š

```js
export default {
  async validate ({ params, store }) {
    // ä½¿ç”¨è‡ªå®šä¹‰æ¶ˆæ¯è§¦å‘å†…éƒ¨æœåŠ¡å™¨500é”™è¯¯
    throw new Error('Under Construction!')
  }
}
```

#### watchQuery

> ç›‘å¬å‚æ•°å­—ç¬¦ä¸²æ›´æ”¹å¹¶åœ¨æ›´æ”¹æ—¶æ‰§è¡Œç»„ä»¶æ–¹æ³• (asyncData, fetch, validate, layout, ...)

`watchQuery` å¯è®¾ç½® `Boolean` æˆ– `Array` (é»˜è®¤: [])ã€‚ä½¿ç”¨ `watchQuery` å±æ€§å¯ä»¥ç›‘å¬å‚æ•°å­—ç¬¦ä¸²çš„æ›´æ”¹ã€‚ å¦‚æœå®šä¹‰çš„å­—ç¬¦ä¸²å‘ç”Ÿå˜åŒ–ï¼Œå°†è°ƒç”¨æ‰€æœ‰ç»„ä»¶æ–¹æ³•(`asyncData`, `fetch`, `validate`, `layout`, ...)ã€‚ ä¸ºäº†æé«˜æ€§èƒ½ï¼Œé»˜è®¤æƒ…å†µä¸‹ç¦ç”¨ã€‚

åœ¨ `nuxt-juejin-project` é¡¹ç›®çš„æœç´¢é¡µä¸­ï¼Œæˆ‘ä¹Ÿç”¨åˆ°äº†è¿™ä¸ªé…ç½®ï¼š

![](https://s1.ax1x.com/2020/05/13/YwBP2R.png)

```html
        {{ item.title }}

        {{ item.title }}

```

```js
export default {
  async asyncData({ app, query }) {
    let res = await app.$api.searchList({
      after: 0,
      first: 20,
      type: query.type ? query.type.toUpperCase() : 'ALL',
      keyword: query.keyword,
      period: query.period ? query.period.toUpperCase() : 'ALL'
    }).then(res => res.s == 1 ? res.d : {})
    return {
      pageInfo: res.pageInfo || {},
      searchList: res.edges || []
    }
  },
  watchQuery: ['keyword', 'type', 'period'],
  methods: {
    search(item) {
      // æ›´æ–°è·¯ç”±å‚æ•°ï¼Œè§¦å‘ watchQueryï¼Œæ‰§è¡Œ asyncData é‡æ–°è·å–æ•°æ®
      this.$router.push({
        name: 'search',
        query: {
          type: item.type || this.type,
          keyword: this.keyword,
          period: item.period || this.period
        }
      })
    }
  }
}
```

ä½¿ç”¨ `watchQuery`æœ‰ç‚¹å¥½å¤„å°±æ˜¯ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨æµè§ˆå™¨åé€€æŒ‰é’®æˆ–å‰è¿›æŒ‰é’®æ—¶ï¼Œé¡µé¢æ•°æ®ä¼šåˆ·æ–°ï¼Œå› ä¸ºå‚æ•°å­—ç¬¦ä¸²å‘ç”Ÿäº†å˜åŒ–ã€‚

#### head

> Nuxt.js ä½¿ç”¨äº† vue-meta æ›´æ–°åº”ç”¨çš„ å¤´éƒ¨æ ‡ç­¾(Head) å’Œ html å±æ€§ã€‚

ä½¿ç”¨ `head` æ–¹æ³•è®¾ç½®å½“å‰é¡µé¢çš„å¤´éƒ¨æ ‡ç­¾ï¼Œè¯¥æ–¹æ³•é‡Œèƒ½é€šè¿‡ `this` è·å–ç»„ä»¶çš„æ•°æ®ã€‚é™¤äº†å¥½çœ‹ä»¥å¤–ï¼Œæ­£ç¡®çš„è®¾ç½® `meta` æ ‡ç­¾ï¼Œè¿˜èƒ½æœ‰åˆ©äºé¡µé¢è¢«æœç´¢å¼•æ“æŸ¥æ‰¾ï¼Œè¿›è¡Œ `seo` ä¼˜åŒ–ã€‚ä¸€èˆ¬éƒ½ä¼šè®¾ç½® `description`(ç®€ä»‹) å’Œ `keyword`(å…³é”®è¯)ã€‚

title:

![](https://s1.ax1x.com/2020/05/14/YwB5sx.png)

meta:

![](https://s1.ax1x.com/2020/05/14/YwDR78.png)

```js
export default {
  head () {
    return {
      title: this.articInfo.title,
      meta: [
        { hid: 'description', name: 'description', content: this.articInfo.content }
      ]
    }
  }
}
```

ä¸ºäº†é¿å…å­ç»„ä»¶ä¸­çš„ `meta` æ ‡ç­¾ä¸èƒ½æ­£ç¡®è¦†ç›–çˆ¶ç»„ä»¶ä¸­ç›¸åŒçš„æ ‡ç­¾è€Œäº§ç”Ÿé‡å¤çš„ç°è±¡ï¼Œå»ºè®®åˆ©ç”¨ `hid` é”®ä¸º `meta` æ ‡ç­¾é…ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¼–å·ã€‚

åœ¨ `nuxt.config.js` ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è®¾ç½®å…¨å±€çš„ `head`:

```js
module.exports = {
  head: {
    title: 'æ˜é‡‘',
    meta: [
      { charset: 'utf-8' },
      { name: 'viewport', content: 'width=device-width,initial-scale=1,user-scalable=no,viewport-fit=cover' },
      { name: 'referrer', content: 'never'},
      { hid: 'keywords', name: 'keywords', content: 'æ˜é‡‘,ç¨€åœŸ,Vue.js,å¾®ä¿¡å°ç¨‹åº,Kotlin,RxJava,React Native,Wireshark,æ•æ·å¼€å‘,Bootstrap,OKHttp,æ­£åˆ™è¡¨è¾¾å¼,WebGL,Webpack,Docker,MVVM'},
      { hid: 'description', name: 'description', content: 'æ˜é‡‘æ˜¯ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒºï¼Œæ˜¯ç»™å¼€å‘è€…ç”¨çš„ Hacker Newsï¼Œç»™è®¾è®¡å¸ˆç”¨çš„ Designer Newsï¼Œå’Œç»™äº§å“ç»ç†ç”¨çš„ Mediumã€‚æ˜é‡‘çš„æŠ€æœ¯æ–‡ç« ç”±ç¨€åœŸä¸Šèšé›†çš„æŠ€æœ¯å¤§ç‰›å’Œæå®¢å…±åŒç¼–è¾‘ä¸ºä½ ç­›é€‰å‡ºæœ€ä¼˜è´¨çš„å¹²è´§ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼šAndroidã€iOSã€å‰ç«¯ã€åç«¯ç­‰æ–¹é¢çš„å†…å®¹ã€‚ç”¨æˆ·æ¯å¤©éƒ½å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æŠ€æœ¯ä¸–ç•Œçš„å¤´æ¡å†…å®¹ã€‚ä¸æ­¤åŒæ—¶ï¼Œæ˜é‡‘å†…è¿˜æœ‰æ²¸ç‚¹ã€æ˜é‡‘ç¿»è¯‘è®¡åˆ’ã€çº¿ä¸‹æ´»åŠ¨ã€ä¸“æ æ–‡ç« ç­‰å†…å®¹ã€‚å³ä½¿ä½ æ˜¯ GitHubã€StackOverflowã€å¼€æºä¸­å›½çš„ç”¨æˆ·ï¼Œæˆ‘ä»¬ç›¸ä¿¡ä½ ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œæœ‰æ‰€æ”¶è·ã€‚'}
    ],
  }
}
```

#### è¡¥å……

ä¸‹é¢æ˜¯è¿™äº›ç”Ÿå‘½å‘¨æœŸçš„è°ƒç”¨é¡ºåºï¼ŒæŸäº›æ—¶å€™å¯èƒ½ä¼šå¯¹æˆ‘ä»¬æœ‰å¸®åŠ©ã€‚

```
validate  =>  asyncData  =>  fetch  =>  head
```

### é…ç½®å¯åŠ¨ç«¯å£

ä»¥ä¸‹ä¸¤è€…éƒ½å¯ä»¥é…ç½®å¯åŠ¨ç«¯å£ï¼Œä½†æˆ‘ä¸ªäººæ›´å–œæ¬¢ç¬¬ä¸€ç§åœ¨ `nuxt.config.js` é…ç½®ï¼Œè¿™æ¯”è¾ƒç¬¦åˆæ­£å¸¸çš„é€»è¾‘ã€‚

#### ç¬¬ä¸€ç§

`nuxt.config.js` :

```js
module.exports = {
  server: {
    port: 8000,
    host: '127.0.0.1'
  }
}
```

#### ç¬¬äºŒç§

`package.json` :

```json
"config": {
  "nuxt": {
    "port": "8000",
    "host": "127.0.0.1"
  }
},
```

### åŠ è½½å¤–éƒ¨èµ„æº

#### å…¨å±€é…ç½®

`nuxt.config.js` :

```js
module.exports = {
  head: {
    link: [
      { rel: 'stylesheet', href: '//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/styles/atom-one-light.min.css' },
    ],
    script: [
      { src: '//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/highlight.min.js' }
    ]
  }
}
```

#### ç»„ä»¶é…ç½®

ç»„ä»¶å†…å¯åœ¨ `head` é…ç½®ï¼Œ `head` å¯ä»¥æ¥å— `object` æˆ– `function`ã€‚å®˜æ–¹ä¾‹å­ä½¿ç”¨çš„æ˜¯ `object` ç±»å‹ï¼Œä½¿ç”¨ `function` ç±»å‹åŒæ ·ç”Ÿæ•ˆã€‚

```js
export default {
  head () {
    return {
      link: [
        { rel: 'stylesheet', href: '//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/styles/atom-one-light.min.css' },
      ],
      script: [
        { src: '//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/highlight.min.js' }
      ]
    }
  }
}
```

### ç¯å¢ƒå˜é‡

`nuxt.config.js`æä¾› `env`é€‰é¡¹è¿›è¡Œé…ç½®ç¯å¢ƒå˜é‡ã€‚ä½†æ­¤å‰æˆ‘å°è¯•è¿‡æ ¹ç›®å½•åˆ›å»º .env æ–‡ä»¶ç®¡ç†ç¯å¢ƒå˜é‡ï¼Œå‘ç°æ˜¯æ— æ•ˆçš„ã€‚

#### åˆ›å»ºç¯å¢ƒå˜é‡

`nuxt.config.js` :

```js
module.exports = {
  env: {
    baseUrl: process.env.NODE_ENV === 'production' ? 'http://test.com' : 'http://127.0.0.1:8000'
  },
}
```

ä»¥ä¸Šé…ç½®æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª `baseUrl` ç¯å¢ƒå˜é‡ï¼Œé€šè¿‡ `process.env.NODE_ENV` åˆ¤æ–­ç¯å¢ƒæ¥åŒ¹é…å¯¹åº”çš„åœ°å€

#### ä½¿ç”¨ç¯å¢ƒå˜é‡

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼æ¥ä½¿ç”¨ `baseUrl` å˜é‡ï¼š

1. é€šè¿‡ `process.env.baseUrl`
2. é€šè¿‡ `context.env.baseUrl`

ä¸¾ä¸ªä¾‹å­ï¼Œ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒæ¥é…ç½® `axios` çš„è‡ªå®šä¹‰å®ä¾‹ã€‚

`/plugins/axios.js`:

```js
export default function (context) {
	$axios.defaults.baseURL = process.env.baseUrl
	// æˆ–è€… $axios.defaults.baseURL = context.env.baseUrl
	$axios.defaults.timeout = 30000
	$axios.interceptors.request.use(config => {
		return config
	})
	$axios.interceptors.response.use(response => {
		return response.data
	})
}
```

### plugins

`plugins` ä½œä¸ºå…¨å±€æ³¨å…¥çš„ä¸»è¦é€”å¾„ï¼Œå…³äºä¸€äº›ä½¿ç”¨çš„æ–¹å¼æ˜¯å¿…é¡»è¦æŒæ¡çš„ã€‚æœ‰æ—¶ä½ å¸Œæœ›åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨æŸä¸ªå‡½æ•°æˆ–å±æ€§å€¼ï¼Œæ­¤æ—¶ï¼Œä½ éœ€è¦å°†å®ƒä»¬æ³¨å…¥åˆ° `Vue` å®ä¾‹ï¼ˆå®¢æˆ·ç«¯ï¼‰ï¼Œ `context` ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰ç”šè‡³ `store(Vuex)` ã€‚

#### plugin å‡½æ•°å‚æ•°

`plugin` ä¸€èˆ¬å‘å¤–æš´éœ²ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ `context` å’Œ `inject`

**contextï¼š** ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å­˜å‚¨å¾ˆå¤šæœ‰ç”¨çš„å±æ€§ã€‚æ¯”å¦‚å¸¸ç”¨çš„ `app` å±æ€§ï¼ŒåŒ…å«æ‰€æœ‰æ’ä»¶çš„ `Vue` æ ¹å®ä¾‹ã€‚ä¾‹å¦‚ï¼šåœ¨ä½¿ç”¨ `axios` çš„æ—¶å€™ï¼Œä½ æƒ³è·å– `$axios` å¯ä»¥ç›´æ¥é€šè¿‡ `context.app.$axios` æ¥è·å–ã€‚

**injectï¼š** è¯¥æ–¹æ³•å¯ä»¥å°† `plugin` åŒæ—¶æ³¨å…¥åˆ° `context`ï¼Œ `Vue` å®ä¾‹ï¼Œ `Vuex` ä¸­ã€‚

ä¾‹å¦‚ï¼š

```js
export default function (context, inject) {}
```

#### æ³¨å…¥ Vue å®ä¾‹

##### å®šä¹‰

`plugins/vue-inject.js` :

```js
import Vue from 'vue'

Vue.prototype.$myInjectedFunction = string => console.log('This is an example', string)
```

##### ä½¿ç”¨

`nuxt.config.js` :

```js
export default {
  plugins: ['~/plugins/vue-inject.js']
}
```

è¿™æ ·åœ¨æ‰€æœ‰ `Vue` ç»„ä»¶ä¸­éƒ½å¯ä»¥ä½¿ç”¨è¯¥å‡½æ•°

```js
export default {
  mounted() {
      this.$myInjectedFunction('test')
  }
}
```

#### æ³¨å…¥ context

`context` æ³¨å…¥æ–¹å¼å’Œåœ¨å…¶å®ƒ `vue` åº”ç”¨ç¨‹åºä¸­æ³¨å…¥ç±»ä¼¼ã€‚

##### å®šä¹‰

`plugins/ctx-inject.js` :

```js
export default ({ app }) => {
  app.myInjectedFunction = string => console.log('Okay, another function', string)
}
```

##### ä½¿ç”¨

`nuxt.config.js` :

```js
export default {
  plugins: ['~/plugins/ctx-inject.js']
}
```

ç°åœ¨ï¼Œåªè¦ä½ è·å¾— `context` ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨è¯¥å‡½æ•°ï¼ˆä¾‹å¦‚åœ¨ `asyncData` å’Œ `fetch` ä¸­ï¼‰

```js
export default {
  asyncData(context) {
    context.app.myInjectedFunction('ctx!')
  }
}
```

#### åŒæ—¶æ³¨å…¥

å¦‚æœéœ€è¦åŒæ—¶åœ¨ `context` ï¼Œ `Vue` å®ä¾‹ï¼Œç”šè‡³ `Vuex` ä¸­åŒæ—¶æ³¨å…¥ï¼Œå¯ä»¥ä½¿ç”¨ `inject` æ–¹æ³•ï¼Œå®ƒæ˜¯ `plugin` å¯¼å‡ºå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚ç³»ç»Ÿä¼šé»˜è®¤å°† `$` ä½œä¸ºæ–¹æ³•åçš„å‰ç¼€ã€‚

##### å®šä¹‰

`plugins/combined-inject.js` :

```js
export default ({ app }, inject) => {
  inject('myInjectedFunction', string => console.log('That was easy!', string))
}
```

##### ä½¿ç”¨

`nuxt.config.js` :

```js
export default {
  plugins: ['~/plugins/combined-inject.js']
}
```

ç°åœ¨ä½ å°±å¯ä»¥åœ¨ `context` ï¼Œæˆ–è€… `Vue` å®ä¾‹ä¸­çš„ `this` ï¼Œæˆ–è€… `Vuex` çš„ `actions` / `mutations` æ–¹æ³•ä¸­çš„ `this` æ¥è°ƒç”¨ `myInjectedFunction` æ–¹æ³•

```js
export default {
  mounted() {
    this.$myInjectedFunction('works in mounted')
  },
  asyncData(context) {
    context.app.$myInjectedFunction('works with context')
  }
}
```

`store/index.js` :

```js
export const state = () => ({
  someValue: ''
})

export const mutations = {
  changeSomeValue(state, newValue) {
    this.$myInjectedFunction('accessible in mutations')
    state.someValue = newValue
  }
}

export const actions = {
  setSomeValueToWhatever({ commit }) {
    this.$myInjectedFunction('accessible in actions')
    const newValue = 'whatever'
    commit('changeSomeValue', newValue)
  }
}
```

#### pluginç›¸äº’è°ƒç”¨

å½“ `plugin` ä¾èµ–äºå…¶ä»–çš„ `plugin` è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—® `context` æ¥è·å–ï¼Œå‰ææ˜¯ `plugin` éœ€è¦ä½¿ç”¨ `context` æ³¨å…¥ã€‚

ä¸¾ä¸ªä¾‹å­ï¼šç°åœ¨å·²å­˜åœ¨ `request` è¯·æ±‚çš„ `plugin` ï¼Œæœ‰å¦ä¸€ä¸ª `plugin` éœ€è¦è°ƒç”¨ `request`

`plugins/request.js` :

```js
export default ({ app: { $axios } }, inject) => {
  inject('request', {
    get (url, params) {
      return $axios({
        method: 'get',
        url,
        params
      })
    }
  })
}
```

`plugins/api.js` ï¼š

```js
export default ({ app: { $request } }, inject) => {
  inject('api', {
    getIndexList(params) {
      return $request.get('/list/indexList', params)
    }
  })
}
```

å€¼å¾—ä¸€æçš„æ˜¯ï¼Œåœ¨æ³¨å…¥ `plugin` æ—¶è¦æ³¨æ„é¡ºåºï¼Œå°±ä¸Šé¢çš„ä¾‹å­æ¥çœ‹ï¼Œ `request` çš„æ³¨å…¥é¡ºåºè¦åœ¨ `api` ä¹‹å‰

```js
module.exports = {
  plugins: [
    './plugins/axios.js',
    './plugins/request.js',
    './plugins/api.js',
  ]
}
```

### è·¯ç”±é…ç½®

åœ¨ `Nuxt.js`ä¸­ï¼Œè·¯ç”±æ˜¯åŸºäºæ–‡ä»¶ç»“æ„è‡ªåŠ¨ç”Ÿæˆï¼Œæ— éœ€é…ç½®ã€‚è‡ªåŠ¨ç”Ÿæˆçš„è·¯ç”±é…ç½®å¯åœ¨ `.nuxt/router.js` ä¸­æŸ¥çœ‹ã€‚

#### åŠ¨æ€è·¯ç”±

åœ¨ `Vue` ä¸­æ˜¯è¿™æ ·é…ç½®åŠ¨æ€è·¯ç”±çš„

```js
const router = new VueRouter({
  routes: [
    {
      path: '/users/:id',
      name: 'user',
      component: User
    }
  ]
})
```

`Nuxt.js` ä¸­éœ€è¦åˆ›å»ºå¯¹åº”çš„ä»¥ä¸‹åˆ’çº¿ä½œä¸ºå‰ç¼€çš„ `Vue` æ–‡ä»¶ æˆ– ç›®å½•

ä»¥ä¸‹é¢ç›®å½•ä¸ºä¾‹ï¼š

```
pages/
--| users/
-----| _id.vue
--| index.vue
```

è‡ªåŠ¨ç”Ÿæˆçš„è·¯ç”±é…ç½®å¦‚ä¸‹:

```js
router:{
  routes: [
    {
      name: 'index',
      path: '/',
      component: 'pages/index.vue'
    },
    {
      name: 'users-id',
      path: '/users/:id?',
      component: 'pages/users/_id.vue'
    }
  ]
}
```

#### åµŒå¥—è·¯ç”±

ä»¥ä¸‹é¢ç›®å½•ä¸ºä¾‹ï¼Œ æˆ‘ä»¬éœ€è¦ä¸€çº§é¡µé¢çš„ `vue` æ–‡ä»¶ï¼Œä»¥åŠå’Œè¯¥æ–‡ä»¶åŒåçš„æ–‡ä»¶å¤¹ï¼ˆç”¨äºå­˜æ”¾å­é¡µé¢ï¼‰

```
pages/
--| users/
-----| _id.vue
-----| index.vue
--| users.vue
```

è‡ªåŠ¨ç”Ÿæˆçš„è·¯ç”±é…ç½®å¦‚ä¸‹:

```js
router: {
  routes: [
    {
      path: '/users',
      component: 'pages/users.vue',
      children: [
        {
          path: '',
          component: 'pages/users/index.vue',
          name: 'users'
        },
        {
          path: ':id',
          component: 'pages/users/_id.vue',
          name: 'users-id'
        }
      ]
    }
  ]
}
```

ç„¶ååœ¨ä¸€çº§é¡µé¢ä¸­ä½¿ç”¨ `nuxt-child` æ¥æ˜¾ç¤ºå­é¡µé¢ï¼Œå°±åƒä½¿ç”¨ `router-view` ä¸€æ ·

```html

```

#### è‡ªå®šä¹‰é…ç½®

é™¤äº†åŸºäºæ–‡ä»¶ç»“æ„ç”Ÿæˆè·¯ç”±å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ä¿®æ”¹ `nuxt.config.js` æ–‡ä»¶çš„ `router` é€‰é¡¹æ¥è‡ªå®šä¹‰ï¼Œè¿™äº›é…ç½®ä¼šè¢«æ·»åŠ åˆ° `Nuxt.js` çš„è·¯ç”±é…ç½®ä¸­ã€‚

ä¸‹é¢ä¾‹å­æ˜¯å¯¹è·¯ç”±æ·»åŠ é‡å®šå‘çš„é…ç½®ï¼š

```js
module.exports = {
  router: {
    extendRoutes (routes, resolve) {
      routes.push({
        path: '/',
        redirect: {
          name: 'timeline-title'
        }
      })
    }
  }
}
```

### axios

#### å®‰è£…

`Nuxt` å·²ä¸ºæˆ‘ä»¬é›†æˆå¥½ `@nuxtjs/axios`ï¼Œå¦‚æœä½ åœ¨åˆ›å»ºé¡¹ç›®æ—¶é€‰æ‹©äº† `axios`ï¼Œè¿™æ­¥å¯ä»¥å¿½ç•¥ã€‚

```bash
npm i @nuxtjs/axios --save
```

`nuxt.config.js` :

```js
module.exports = {
  modules: [
    '@nuxtjs/axios'
  ],
}
```

#### SSRä½¿ç”¨Axios

æœåŠ¡å™¨ç«¯è·å–å¹¶æ¸²æŸ“æ•°æ®ï¼Œ `asyncData` æ–¹æ³•å¯ä»¥åœ¨æ¸²æŸ“ç»„ä»¶ä¹‹å‰å¼‚æ­¥è·å–æ•°æ®ï¼Œå¹¶æŠŠè·å–çš„æ•°æ®è¿”å›ç»™å½“å‰ç»„ä»¶ã€‚

```js
export default {
  async asyncData(context) {
    let data = await context.app.$axios.get("/test")
    return {
      list: data
    };
  },
  data() {
    return {
      list: []
    }
  }
}
```

#### éSSRä½¿ç”¨Axios

è¿™ç§ä½¿ç”¨æ–¹å¼å°±å’Œæˆ‘ä»¬å¹³å¸¸ä¸€æ ·ï¼Œè®¿é—® `this` è¿›è¡Œè°ƒç”¨

```js
export default {
  data() {
    return {
      list: []
    }
  },
  async created() {
    let data = await this.$axios.get("/test")
    this.list = data
  },
}
```

#### è‡ªå®šä¹‰é…ç½®Axios

å¤§å¤šæ—¶å€™ï¼Œæˆ‘ä»¬éƒ½éœ€è¦å¯¹ `axios` åšè‡ªå®šä¹‰é…ç½®ï¼ˆbaseUrlã€æ‹¦æˆªå™¨ï¼‰ï¼Œè¿™æ—¶å¯ä»¥é€šè¿‡é…ç½® `plugins` æ¥å¼•å…¥ã€‚

##### å®šä¹‰

`/plugins/axios.js` :

```js
export default function({ app: { $axios } }) {
  $axios.defaults.baseURL = 'http://127.0.0.1:8000/'
  $axios.interceptors.request.use(config => {
    return config
  })
  $axios.interceptors.response.use(response => {
    if (/^[4|5]/.test(response.status)) {
      return Promise.reject(response.statusText)
    }
    return response.data
  })
}
```

##### ä½¿ç”¨

`nuxt.config.js` :

```js
module.exports = {
  plugins: [
    './plugins/axios.js'
  ],
}
```

å®Œæˆåï¼Œä½¿ç”¨æ–¹å¼ä¹Ÿå’Œä¸Šé¢çš„ä¸€æ ·ã€‚

### cssé¢„å¤„ç†å™¨

ä»¥ `scss` ä¸ºä¾‹å­

#### å®‰è£…

```bash
npm i node-sass sass-loader scss-loader --save--dev
```

#### ä½¿ç”¨

æ— éœ€é…ç½®ï¼Œæ¨¡æ¿å†…ç›´æ¥ä½¿ç”¨

```css
.box{
    color: $theme;
}

```

#### å…¨å±€æ ·å¼

åœ¨ç¼–å†™å¸ƒå±€æ ·å¼æ—¶ï¼Œä¼šæœ‰å¾ˆå¤šç›¸åŒå…±ç”¨çš„æ ·å¼ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥å°†è¿™äº›æ ·å¼æå–å‡ºæ¥ï¼Œéœ€è¦ç”¨åˆ°æ—¶åªéœ€è¦æ·»åŠ ä¸€ä¸ªç±»åå³å¯ã€‚

##### å®šä¹‰

`global.scss` :

```css
.shadow{
  box-shadow: 0 1px 2px 0 rgba(0,0,0,.05);
}
.ellipsis{
  text-overflow: ellipsis;
  white-space: nowrap;
  overflow: hidden;
}
.main{
  width: 960px;
  margin: 0 auto;
  margin-top: 20px;
}
```

##### ä½¿ç”¨

`nuxt.config.js` :

```js
module.exports = {
  css: [
    '~/assets/scss/global.scss'
  ],
}
```

#### å…¨å±€å˜é‡

ä¸ºé¡µé¢æ³¨å…¥ å˜é‡ å’Œ `mixin` è€Œä¸”ä¸ç”¨æ¯æ¬¡éƒ½å»å¯¼å…¥ä»–ä»¬ï¼Œå¯ä»¥ä½¿ç”¨ `@nuxtjs/style-resources` æ¥å®ç°ã€‚

##### å®‰è£…

```bash
npm i @nuxtjs/style-resources --save--dev
```

##### å®šä¹‰

`/assets/scss/variable.scss`:

```css
#$theme: #007fff;
#$success: #6cbd45;
#$success-2: #74ca46;
```

##### ä½¿ç”¨

`nuxt.config.js` :

```js
module.exports = {
  modules: [
    '@nuxtjs/style-resources'
  ],
  styleResources: {
    scss: [
      './assets/scss/variable.scss'
    ]
  },
}
```

#### element-ui è‡ªå®šä¹‰ä¸»é¢˜

##### å®šä¹‰

`/assets/scss/element-variables.scss` ï¼š

```css
/* æ”¹å˜ä¸»é¢˜è‰²å˜é‡ */
/* $theme åœ¨ä¸Šé¢çš„ scss æ–‡ä»¶ä¸­å®šä¹‰å¹¶ä½¿ç”¨ */
$--color-primary: $theme;

/* æ”¹å˜ icon å­—ä½“è·¯å¾„å˜é‡ï¼Œå¿…éœ€ */
$--font-path: '~element-ui/lib/theme-chalk/fonts';

/* ç»„ä»¶æ ·å¼æŒ‰éœ€å¼•å…¥ */
@import "~element-ui/packages/theme-chalk/src/select";
@import "~element-ui/packages/theme-chalk/src/option";
@import "~element-ui/packages/theme-chalk/src/input";
@import "~element-ui/packages/theme-chalk/src/button";
@import "~element-ui/packages/theme-chalk/src/notification";
@import "~element-ui/packages/theme-chalk/src/message";
```

##### ä½¿ç”¨

`nuxt.config.js` :

```js
module.exports = {
  modules: [
    '@nuxtjs/style-resources'
  ],
  styleResources: {
    scss: [
      /*
      * è¿™é‡Œéœ€è¦æ³¨æ„ä½¿ç”¨çš„é¡ºåºï¼Œå› ä¸º element-variables.scss é‡Œç”¨åˆ° variable.scss é‡Œå®šä¹‰çš„å˜é‡
      * å¦‚æœé¡ºåºåè¿‡æ¥ï¼Œåœ¨å¯åŠ¨ç¼–è¯‘æ—¶ä¼šå¯¼è‡´å˜é‡æ‰¾ä¸åˆ°æŠ¥é”™
      */
      '~/assets/scss/variable.scss',
      '~/assets/scss/element-variables.scss'
    ]
  },
}
```

è¿˜æœ‰å¦ä¸€ä¸ªæ–¹æ³•å¯ä»¥ä½¿ç”¨ï¼Œé‚£å°±æ˜¯ `plugin`

```js
import Vue from 'vue'
import myComponentsInstall from '~/components/myComponentsInstall'
import eleComponentsInstall from '~/components/eleComponentsInstall'
import '~/assets/scss/element-variables.scss' // elementUI è‡ªå®šä¹‰ä¸»é¢˜è‰²

Vue.use(myComponentsInstall)
Vue.use(eleComponentsInstall)
```

## å‰ç«¯æŠ€æœ¯ç‚¹

### asyncDataè¯·æ±‚å¹¶è¡Œ

çœ‹åˆ°è¿™é‡Œä½ åº”è¯¥èƒ½æ„Ÿè§‰åˆ° `asyncData` çš„é‡è¦æ€§ï¼Œå¯¹äºè¿™ç§ç»å¸¸ä¼šä½¿ç”¨åˆ°çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸€äº›ç»†èŠ‚ä¸Šçš„ä¿®æ”¹å°±æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚é€šå¸¸ï¼Œ `asyncData` ä¸­ä¸åªå‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œå¯èƒ½æ˜¯å¾ˆå¤šä¸ªï¼š

```js
export default {
  async asyncData({ app }) {
    // æ–‡ç« åˆ—è¡¨
    let indexData = await app.$api.getIndexList({
      first: 20,
      order: 'POPULAR',
      category: 1
    }).then(res => res.s == 1 ? res.d : {})
    // æ¨èä½œè€…
    let recommendAuthors = await app.$api.getRecommendAuthor({
      limit: 5
    }).then(res => res.s == 1 ? res.d : [])
    // æ¨èå°å†Œ
    let recommendBooks = await app.$api.getRecommendBook().then(res => res.s === 1 ? res.d.data : [])
    return {
      indexData,
      recommendAuthors,
      recommendBooks
    }
  }
}
```

ä¸Šé¢çš„æ“ä½œçœ‹èµ·æ¥æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†å…¶å®æœ‰ä¸ªç»†èŠ‚å¯ä»¥ä¼˜åŒ–ä¸€ä¸‹ã€‚ç°åœ¨æ¥ç›˜ä¸€ç›˜ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ `async/await` ä¼šå°†å¼‚æ­¥ä»»åŠ¡å»åŒæ­¥åŒ–æ‰§è¡Œï¼Œä¸Šä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡æ²¡ç»“æŸä¹‹å‰ï¼Œä¸‹ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡å¤„äºç­‰å¾…çŠ¶æ€ä¸­ã€‚è¿™æ ·éœ€è¦ç­‰å¾…3ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œå‡è®¾è¿™äº›è¯·æ±‚å‡è€—æ—¶1ç§’ï¼Œä¹Ÿå°±æ˜¯è¯´é¡µé¢è‡³å°‘è¦ç­‰å¾…3ç§’åæ‰ä¼šå‡ºç°å†…å®¹ã€‚åŸæœ¬æˆ‘ä»¬æƒ³åˆ©ç”¨æœåŠ¡ç«¯æ¸²æŸ“æ¥ä¼˜åŒ–é¦–å±ï¼Œç°åœ¨å´å› ä¸ºç­‰å¾…è¯·æ±‚è€Œæ‹–æ…¢é¡µé¢æ¸²æŸ“ï¼Œå²‚ä¸æ˜¯å¾—ä¸å¿å¤±ã€‚

æœ€å¥½çš„æ–¹æ¡ˆåº”è¯¥æ˜¯å¤šä¸ªè¯·æ±‚åŒæ—¶å‘é€ï¼Œå¯èƒ½èªæ˜çš„å°ä¼™ä¼´å·²ç»æƒ³åˆ° `Promise.all`ã€‚æ²¡é”™ï¼Œåˆ©ç”¨ `Promise.all` å°†è¿™äº›è¯·æ±‚å¹¶è¡Œå‘é€ï¼Œå°±èƒ½è§£å†³ä¸Šè¿°çš„é—®é¢˜ã€‚ `Promise.all` æ¥å—ä¸€ä¸ª `Promise` æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œå½“å…¨éƒ¨ `Promise` æˆåŠŸæ—¶ä¼šè¿”å›ä¸€ä¸ªç»“æœæ•°ç»„ã€‚æœ€ç»ˆçš„è€—æ—¶ä¼šä»¥æœ€ä¹…çš„ `Promise` ä¸ºå‡†ï¼Œæ‰€ä»¥è¯´åŸæœ¬3ç§’çš„è€—æ—¶å¯ä»¥é™ä½åˆ°1ç§’ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå…¶ä¸­æœ‰ä¸€ä¸ªè¯·æ±‚å¤±è´¥äº†ï¼Œä¼šè¿”å›æœ€å…ˆè¢« `reject` å¤±è´¥çŠ¶æ€çš„å€¼ï¼Œå¯¼è‡´è·å–ä¸åˆ°æ•°æ®ã€‚åœ¨é¡¹ç›®å°è£…åŸºç¡€è¯·æ±‚æ—¶æˆ‘å·²ç»åšäº† `catch` é”™è¯¯çš„å¤„ç†ï¼Œæ‰€ä»¥ç¡®ä¿è¯·æ±‚éƒ½ä¸ä¼šè¢« `reject`ã€‚

```js
export default {
  asyncData() {
    // æ•°ç»„è§£æ„è·å¾—å¯¹åº”è¯·æ±‚çš„æ•°æ®
    let [indexData, recommendAuthors, recommendBooks] = await Promise.all([
      // æ–‡ç« åˆ—è¡¨
      app.$api.getIndexList({
        first: 20,
        order: 'POPULAR',
        category: 1
      }).then(res => res.s == 1 ? res.d : {}),
      // æ¨èä½œè€…
      app.$api.getRecommendAuthor({
        limit: 5
      }).then(res => res.s == 1 ? res.d : []),
      // æ¨èå°å†Œ
      app.$api.getRecommendBook().then(res => res.s === 1 ? res.d.data : []),
    ])
    return {
      indexData,
      recommendAuthors,
      recommendBooks
    }
  }
}
```

### tokençš„è®¾ç½®ä¸å­˜å‚¨

ä¸€ä¸ªåº”ç”¨å¿…ä¸å¯å°‘çš„åŠŸèƒ½å°±æ˜¯ `token` éªŒè¯ï¼Œé€šå¸¸æˆ‘ä»¬åœ¨ç™»å½•åæŠŠè¿”å›çš„éªŒè¯ä¿¡æ¯å­˜å‚¨èµ·æ¥ï¼Œä¹‹åè¯·æ±‚å¸¦ä¸Š `token` ä¾›åç«¯éªŒè¯çŠ¶æ€ã€‚åœ¨å‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ä¸­ï¼Œä¸€èˆ¬éƒ½ä¼šå­˜æ”¾åˆ°æœ¬åœ°å­˜å‚¨ä¸­ã€‚ä½† `Nuxt.js` ä¸åŒï¼Œç”±äºæœåŠ¡ç«¯æ¸²æŸ“çš„ç‰¹ç‚¹ï¼Œéƒ¨åˆ†è¯·æ±‚åœ¨æœåŠ¡ç«¯å‘èµ·ï¼Œæˆ‘ä»¬æ— æ³•è·å– `localStorage` æˆ– `sessionStorage`ã€‚

è¿™æ—¶å€™ï¼Œ `cookie` å°±æ´¾ä¸Šäº†ç”¨åœºã€‚ `cookie` ä¸ä»…èƒ½åœ¨å®¢æˆ·ç«¯ä¾›æˆ‘ä»¬æ“ä½œï¼Œåœ¨è¯·æ±‚æ—¶ä¹Ÿä¼šå¸¦ä¸Šå‘å›ç»™æœåŠ¡ç«¯ã€‚ä½¿ç”¨åŸç”Ÿæ“ä½œ `cooike` æ˜¯éå¸¸éº»çƒ¦çš„ï¼Œå€ŸåŠ© `cookie-universal-nuxt` æ¨¡å—ï¼ˆè¯¥æ¨¡å—åªæ˜¯å¸®åŠ©æˆ‘ä»¬æ³¨å…¥ï¼Œä¸»è¦å®ç°ä¾èµ– `cookie-universal`ï¼‰ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ›´æ–¹ä¾¿çš„ä½¿ç”¨ `cookie`ã€‚ä¸ç®¡åœ¨æœåŠ¡ç«¯è¿˜æ˜¯å®¢æˆ·ç«¯ï¼Œ `cookie-universal-nuxt` éƒ½ä¸ºæˆ‘ä»¬æä¾›ä¸€è‡´çš„ `api`ï¼Œå®ƒå†…éƒ¨ä¼šå¸®æˆ‘ä»¬å»é€‚é…å¯¹åº”çš„æ–¹æ³•ã€‚

#### å®‰è£…

å®‰è£… `cookie-universal-nuxt`

```bash
npm run cookie-universal-nuxt --save
```

`nuxt.config.js` :

```js
module.exports = {
  modules: [
    'cookie-universal-nuxt'
  ],
}
```

#### åŸºç¡€ä½¿ç”¨

åŒæ ·çš„ï¼Œ `cookie-universal-nuxt` ä¼šåŒæ—¶æ³¨å…¥ï¼Œè®¿é—® `$cookies` è¿›è¡Œä½¿ç”¨ã€‚

æœåŠ¡ç«¯ï¼š

```js
// è·å–
app.$cookies.get('name')
// è®¾ç½®
app.$cookies.set('name', 'value')
// åˆ é™¤
app.$cookies.remove('name')
```

å®¢æˆ·ç«¯ï¼š

```js
// è·å–
this.$cookies.get('name')
// è®¾ç½®
this.$cookies.set('name', 'value')
// åˆ é™¤
this.$cookies.remove('name')
```

æ›´å¤šä½¿ç”¨æ–¹æ³•æˆ³è¿™é‡Œ [https://www.npmjs.com/package/cookie-universal-nuxt](https://www.npmjs.com/package/cookie-universal-nuxt)

#### å®é™…åº”ç”¨æµç¨‹

åƒæ˜é‡‘çš„ç™»å½•ï¼Œæˆ‘ä»¬åœ¨ç™»å½•åéªŒè¯ä¿¡æ¯ä¼šè¢«é•¿æœŸå­˜å‚¨èµ·æ¥ï¼Œè€Œä¸æ˜¯æ¯æ¬¡ä½¿ç”¨éƒ½è¦è¿›è¡Œç™»å½•ã€‚ä½† `cookie` ç”Ÿå‘½å‘¨æœŸåªå­˜åœ¨äºæµè§ˆå™¨ï¼Œå½“æµè§ˆå™¨å…³é—­åä¹Ÿä¼šéšä¹‹é”€æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸ºå…¶è®¾ç½®ä¸€ä¸ªè¾ƒé•¿çš„è¿‡æœŸæ—¶é—´ã€‚

åœ¨é¡¹ç›®ä¸­æˆ‘å°†è®¾ç½®èº«ä»½ä¿¡æ¯å°è£…æˆå·¥å…·æ–¹æ³•ï¼Œåœ¨ç™»å½•æˆåŠŸåä¼šè°ƒç”¨æ­¤æ–¹æ³•ï¼š

`/utils/utils.js` :

```js
setAuthInfo(ctx, res) {
  let $cookies, $store
  // å®¢æˆ·ç«¯
  if (process.client) {
    $cookies = ctx.$cookies
    $store = ctx.$store
  }
  // æœåŠ¡ç«¯
  if (process.server) {
    $cookies = ctx.app.$cookies
    $store = ctx.store
  }
  if ($cookies && $store) {
    // è¿‡æœŸæ—¶é•¿ new Date(Date.now() + 8.64e7 * 365 * 10)
    const expires = $store.state.auth.cookieMaxExpires
    // è®¾ç½®cookie
    $cookies.set('userId', res.userId, { expires })
    $cookies.set('clientId', res.clientId, { expires })
    $cookies.set('token', res.token, { expires })
    $cookies.set('userInfo', res.user, { expires })
    // è®¾ç½®vuex
    $store.commit('auth/UPDATE_USERINFO', res.user)
    $store.commit('auth/UPDATE_CLIENTID', res.clientId)
    $store.commit('auth/UPDATE_TOKEN', res.token)
    $store.commit('auth/UPDATE_USERID', res.userId)
  }
}
```

ä¹‹åéœ€è¦æ”¹é€ ä¸‹ `axios`ï¼Œè®©å®ƒåœ¨è¯·æ±‚æ—¶å¸¦ä¸ŠéªŒè¯ä¿¡æ¯ï¼š

`/plugins/axios.js` :

```js
export default function ({ app: { $axios, $cookies } }) {
	$axios.defaults.baseURL = process.env.baseUrl
	$axios.defaults.timeout = 30000
	$axios.interceptors.request.use(config => {
    // å¤´éƒ¨å¸¦ä¸ŠéªŒè¯ä¿¡æ¯
		config.headers['X-Token'] = $cookies.get('token') || ''
		config.headers['X-Device-Id'] = $cookies.get('clientId') || ''
		config.headers['X-Uid'] = $cookies.get('userId') || ''
		return config
	})
	$axios.interceptors.response.use(response => {
		if (/^[4|5]/.test(response.status)) {
			return Promise.reject(response.statusText)
		}
		return response.data
	})
}
```

### æƒé™éªŒè¯ä¸­é—´ä»¶

ä¸Šé¢æåˆ°èº«ä»½ä¿¡æ¯ä¼šè®¾ç½®ä¸€ä¸ªé•¿æœŸçš„æ—¶é—´ï¼Œæ¥ä¸‹æ¥å½“ç„¶å°±éœ€è¦éªŒè¯èº«ä»½æ˜¯å¦è¿‡æœŸå•¦ã€‚è¿™é‡Œæˆ‘ä¼šä½¿ç”¨è·¯ç”±ä¸­é—´ä»¶æ¥å®ŒæˆéªŒè¯åŠŸèƒ½ï¼Œä¸­é—´ä»¶è¿è¡Œåœ¨ä¸€ä¸ªé¡µé¢æˆ–ä¸€ç»„é¡µé¢æ¸²æŸ“ä¹‹å‰ï¼Œå°±åƒè·¯ç”±å®ˆå«ä¸€æ ·ã€‚è€Œæ¯ä¸€ä¸ªä¸­é—´ä»¶åº”æ”¾ç½®åœ¨ `middleware` ç›®å½•ï¼Œæ–‡ä»¶åçš„åç§°å°†æˆä¸ºä¸­é—´ä»¶åç§°ã€‚ä¸­é—´ä»¶å¯ä»¥å¼‚æ­¥æ‰§è¡Œï¼Œåªéœ€è¦è¿”å› `Promise` å³å¯ã€‚

#### å®šä¹‰

`/middleware/auth.js`ï¼š

```js
export default function (context) {
  const { app, store } = context
  const cookiesToken = app.$cookies.get('token')
  if (cookiesToken) {
    // æ¯æ¬¡è·³è½¬è·¯ç”± éªŒè¯ç™»å½•çŠ¶æ€æ˜¯å¦è¿‡æœŸ
    return app.$api.isAuth().then(res => {
      if (res.s === 1) {
        if (res.d.isExpired) {   // è¿‡æœŸ ç§»é™¤ç™»é™†éªŒè¯ä¿¡æ¯
          app.$utils.removeAuthInfo(context)
        } else {                 // æœªè¿‡æœŸ é‡æ–°è®¾ç½®å­˜å‚¨
          const stateToken = store.state.auth.token
          if (cookiesToken && stateToken === '') {
            store.commit('auth/UPDATE_USERINFO', app.$cookies.get('userInfo'))
            store.commit('auth/UPDATE_USERID', app.$cookies.get('userId'))
            store.commit('auth/UPDATE_CLIENTID', app.$cookies.get('clientId'))
            store.commit('auth/UPDATE_TOKEN', app.$cookies.get('token'))
          }
        }
      }
    })
  }
}
```

ä¸Šé¢ `if (cookiesToken && stateToken === '')` ä¸­çš„å¤„ç†ï¼Œæ˜¯å› ä¸ºä¸€äº›é¡µé¢ä¼šæ–°å¼€æ ‡ç­¾é¡µï¼Œå¯¼è‡´ `vuex` ä¸­çš„ä¿¡æ¯ä¸¢å¤±ï¼Œè¿™é‡Œéœ€è¦åˆ¤æ–­ä¸€ä¸‹é‡æ–°è®¾ç½®çŠ¶æ€æ ‘ã€‚

#### ä½¿ç”¨

`nuxt.config.js` :

```js
module.exports = {
  router: {
    middleware: ['auth']
  },
}
```

è¿™ç§ä¸­é—´ä»¶ä½¿ç”¨æ˜¯æ³¨å…¥åˆ°å…¨å±€çš„æ¯ä¸ªé¡µé¢ä¸­ï¼Œå¦‚æœä½ å¸Œæœ›ä¸­é—´ä»¶åªè¿è¡ŒäºæŸä¸ªé¡µé¢ï¼Œå¯ä»¥é…ç½®é¡µé¢çš„ `middleware` é€‰é¡¹ï¼š

```js
export default {
  middleware: 'auth'
}
```

#è·¯ç”±ä¸­é—´ä»¶æ–‡æ¡£æˆ³è¿™é‡Œ [https://www.nuxtjs.cn/guide/routing#%E4%B8%AD%E9%97%B4%E4%BB%B6]#(https://www.nuxtjs.cn/guide/routing#%E4%B8%AD%E9%97%B4%E4%BB%B6)

### ç»„ä»¶æ³¨å†Œç®¡ç†

å…ˆæ¥ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œåœ¨ `plugins` æ–‡ä»¶å¤¹ä¸‹åˆ›å»º `vue-global.js` ç”¨äºç®¡ç†å…¨å±€éœ€è¦ä½¿ç”¨çš„ç»„ä»¶æˆ–æ–¹æ³•ï¼š

```js
import Vue from 'vue'
import utils from '~/utils'
import myComponent from '~/components/myComponent.vue'

Vue.prototype.$utils = utils

Vue.use(myComponent)
```

`nuxt.config.js` ï¼š

```js
module.exports = {
  plugins: [
    '~/plugins/vue-global.js'
  ],
}
```

#### è‡ªå®šä¹‰ç»„ä»¶

å¯¹äºä¸€äº›è‡ªå®šä¹‰å…¨å±€å…±ç”¨ç»„ä»¶ï¼Œæˆ‘çš„åšæ³•æ˜¯å°†å®ƒä»¬æ”¾å…¥ `/components/common` æ–‡ä»¶å¤¹ç»Ÿä¸€ç®¡ç†ã€‚è¿™æ ·å¯ä»¥ä½¿ç”¨ `require.context` æ¥è‡ªåŠ¨åŒ–çš„å¼•å…¥ç»„ä»¶ï¼Œè¯¥æ–¹æ³•æ˜¯ç”± `webpack` æä¾›çš„ï¼Œå®ƒèƒ½å¤Ÿè¯»å–æ–‡ä»¶å¤¹å†…æ‰€æœ‰æ–‡ä»¶ã€‚å¦‚æœä½ ä¸çŸ¥é“è¿™ä¸ªæ–¹æ³•ï¼ŒçœŸçš„å¾ˆå¼ºçƒˆä½ å»äº†è§£å¹¶ä½¿ç”¨ä¸€ä¸‹ï¼Œå®ƒèƒ½å¤§å¤§æé«˜ä½ çš„ç¼–ç¨‹æ•ˆç‡ã€‚

##### å®šä¹‰

`/components/myComponentsInstall.js` :

```js
export default {
  install(Vue) {
    const components = require.context('~/components/common', false, /\.vue$/)
    // components.keys() è·å–æ–‡ä»¶åæ•°ç»„
    components.keys().map(path => {
      // è·å–ç»„ä»¶æ–‡ä»¶å
      const fileName = path.replace(/(.*\/)*([^.]+).*/ig, "$2")
      // components(path).default è·å– ES6 è§„èŒƒæš´éœ²çš„å†…å®¹ï¼Œcomponents(path) è·å– Common.js è§„èŒƒæš´éœ²çš„å†…å®¹
      Vue.component(fileName, components(path).default || components(path))
    })
  }
}
```

##### ä½¿ç”¨

`/plugins/vue-global.js` :

```js
import Vue from 'vue'
import myComponentsInstall from '~/components/myComponentsInstall'

Vue.use(myComponentsInstall)
```

ç»è¿‡ä¸Šé¢çš„æ“ä½œåï¼Œç»„ä»¶å·²åœ¨å…¨å±€è¢«æ³¨å†Œï¼Œæˆ‘ä»¬åªè¦æŒ‰çŸ­æ¨ªçº¿å‘½åä½¿ç”¨å³å¯ã€‚è€Œä¸”æ¯æ–°å»ºä¸€ä¸ªç»„ä»¶éƒ½æ— éœ€å†å»å¼•å…¥ï¼ŒçœŸçš„æ˜¯ä¸€åŠ³æ°¸é€¸ã€‚åŒæ ·åœ¨å…¶ä»–å®é™…åº”ç”¨ä¸­ï¼Œå¦‚æœ `api` æ–‡ä»¶æ˜¯æŒ‰åŠŸèƒ½åˆ†æ¨¡å—ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•å»è‡ªåŠ¨åŒ–å¼•å…¥æ¥å£æ–‡ä»¶ã€‚

#### ç¬¬ä¸‰æ–¹ç»„ä»¶åº“ï¼ˆelement-UIï¼‰

##### å…¨éƒ¨å¼•å…¥

`/plugins/vue-global.js` ï¼š

```js
import Vue from 'vue'
import elementUI from 'element-ui'

Vue.use(elementUI)
```

`nuxt.config.js` :

```js
module.exports = {
  css: [
    'element-ui/lib/theme-chalk/index.css'
  ]
}
```

##### æŒ‰éœ€å¼•å…¥

å€ŸåŠ© `babel-plugin-component`ï¼Œæˆ‘ä»¬å¯ä»¥åªå¼•å…¥éœ€è¦çš„ç»„ä»¶ï¼Œä»¥è¾¾åˆ°å‡å°é¡¹ç›®ä½“ç§¯çš„ç›®çš„ã€‚

```bash
npm install babel-plugin-component -D
```

`nuxt.config.js` :

```js
module.exports = {
  build: {
    plugins: [
      [
        "component",
        {
          "libraryName": "element-ui",
          "styleLibraryName": "theme-chalk"
        }
      ]
    ],
  }
}
```

æ¥ä¸‹æ¥å¼•å…¥æˆ‘ä»¬éœ€è¦çš„éƒ¨åˆ†ç»„ä»¶ï¼ŒåŒæ ·åˆ›å»ºä¸€ä¸ª `eleComponentsInstall.js` ç®¡ç† elementUI çš„ç»„ä»¶ï¼š

`/components/eleComponentsInstall.js` :

```js
import { Input, Button, Select, Option, Notification, Message } from 'element-ui'

export default {
  install(Vue) {
    Vue.use(Input)
    Vue.use(Select)
    Vue.use(Option)
    Vue.use(Button)
    Vue.prototype.$message = Message
    Vue.prototype.$notify  = Notification
  }
}
```

`/plugins/vue-global.js`:

```js
import Vue from 'vue'
import eleComponentsInstall from '~/components/eleComponentsInstall'

Vue.use(eleComponentsInstall)
```

### é¡µé¢å¸ƒå±€åˆ‡æ¢

åœ¨æˆ‘ä»¬æ„å»ºç½‘ç«™åº”ç”¨æ—¶ï¼Œå¤§å¤šæ•°é¡µé¢çš„å¸ƒå±€éƒ½ä¼šä¿æŒä¸€è‡´ã€‚ä½†åœ¨æŸäº›éœ€æ±‚ä¸­ï¼Œå¯èƒ½éœ€è¦æ›´æ¢å¦ä¸€ç§å¸ƒå±€æ–¹å¼ï¼Œè¿™æ—¶é¡µé¢ `layout` é…ç½®é€‰é¡¹å°±èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å®Œæˆã€‚è€Œæ¯ä¸€ä¸ªå¸ƒå±€æ–‡ä»¶åº”æ”¾ç½®åœ¨ `layouts` ç›®å½•ï¼Œæ–‡ä»¶åçš„åç§°å°†æˆä¸ºå¸ƒå±€åç§°ï¼Œé»˜è®¤å¸ƒå±€æ˜¯ `default`ã€‚ä¸‹é¢çš„ä¾‹å­æ˜¯æ›´æ¢é¡µé¢å¸ƒå±€çš„èƒŒæ™¯è‰²ã€‚å…¶å®æŒ‰ç…§ä½¿ç”¨ `Vue` çš„ç†è§£ï¼Œæ„Ÿè§‰å°±åƒåˆ‡æ¢ `App.vue`ã€‚

#### å®šä¹‰

`/layouts/default.vue` :

```html

```

`/layouts/default-white.vue` :

```html

```

#### ä½¿ç”¨

é¡µé¢ç»„ä»¶æ–‡ä»¶ï¼š

```js
export default {
  layout: 'default-white',
  // æˆ–
  layout(context) {
    return 'default-white'
  }
}
```

### è‡ªå®šä¹‰é”™è¯¯é¡µ

è‡ªå®šä¹‰çš„é”™è¯¯é¡µéœ€è¦æ”¾åœ¨ `layouts` ç›®å½•ä¸­ï¼Œä¸”æ–‡ä»¶åä¸º `error`ã€‚è™½ç„¶æ­¤æ–‡ä»¶æ”¾åœ¨ `layouts` ç›®å½•ä¸­, ä½†åº”è¯¥å°†å®ƒçœ‹ä½œæ˜¯ä¸€ä¸ªé¡µé¢(page)ã€‚è¿™ä¸ªå¸ƒå±€æ–‡ä»¶ä¸éœ€è¦åŒ…å« `<nuxt></nuxt>` æ ‡ç­¾ã€‚ä½ å¯ä»¥æŠŠè¿™ä¸ªå¸ƒå±€æ–‡ä»¶å½“æˆæ˜¯æ˜¾ç¤ºåº”ç”¨é”™è¯¯ï¼ˆ404ï¼Œ500ç­‰ï¼‰çš„ç»„ä»¶ã€‚

#### å®šä¹‰

```html
      {{statusCode}} - {{ message }}
      å›åˆ°é¦–é¡µ

```

```js
export default {
  props: {
    error: {
      type: Object,
      default: null
    }
  },
  computed: {
    statusCode () {
      return (this.error && this.error.statusCode) || 500
    },
    message () {
      return this.error.message || 'Error'
    }
  },
  head () {
    return {
      title: `${this.statusCode === 404 ? 'æ‰¾ä¸åˆ°é¡µé¢' : 'å‘ˆç°é¡µé¢å‡ºé”™'} - æ˜é‡‘`,
      meta: [
        {
          name: 'viewport',
          content: 'width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no'
        }
      ]
    }
  }
}
```

#### errorå¯¹è±¡

é”™è¯¯é¡µé¢ä¸­ `props` æ¥å—ä¸€ä¸ª `error` å¯¹è±¡ï¼Œè¯¥å¯¹è±¡è‡³å°‘åŒ…å«ä¸¤ä¸ªå±æ€§ `statusCode` å’Œ `message`ã€‚

é™¤äº†è¿™ä¸¤ä¸ªå±æ€§ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä¼ è¿‡å»å…¶ä»–çš„å±æ€§ï¼Œè¿™é‡Œåˆè¦è¯´èµ·ä¸Šé¢æåˆ°çš„ `error` æ–¹æ³•ï¼š

```js
export default {
  async asyncData({ app, query, error }) {
    const tagInfo = await app.$api.getTagDetail({
      tagName: encodeURIComponent(query.name)
    }).then(res => {
      if (res.s === 1) {
        return res.d
      } else {
        // è¿™æ ·æˆ‘ä»¬åœ¨ error å¯¹è±¡ä¸­åˆå¤šäº† query å±æ€§
        error({
          statusCode: 404,
          message: 'æ ‡ç­¾ä¸å­˜åœ¨',
          query
        })
        return
      }
    })
    return {
      tagInfo
    }
  }
}
```

è¿˜æœ‰é¡µé¢çš„ `validate` ç”Ÿå‘½å‘¨æœŸï¼š

```js
export default {
  async validate ({ params, store }) {
    throw new Error('é¡µé¢å‚æ•°ä¸æ­£ç¡®')
  }
}
```

è¿™é‡Œä¼ è¿‡å»çš„ `statusCode` ä¸º 500ï¼Œ `message` å°±æ˜¯ `new Error` ä¸­çš„å†…å®¹ã€‚å¦‚æœæƒ³ä¼ å¯¹è±¡è¿‡å»çš„è¯ï¼Œ `message` ä¼šè½¬ä¸ºå­—ç¬¦ä¸² `[object Object]`ï¼Œä½ å¯ä»¥ä½¿ç”¨ `JSON.stringify` ä¼ è¿‡å»ï¼Œé”™è¯¯é¡µé¢å†å¤„ç†è§£æå‡ºæ¥ã€‚

```js
export default {
  async validate ({ params, store }) {
    throw new Error(JSON.stringify({
      message: 'validateé”™è¯¯',
      params
    }))
  }
}
```

### å°è£…è§¦åº•äº‹ä»¶

é¡¹ç›®ä¸­åŸºæœ¬æ¯ä¸ªé¡µé¢çš„éƒ½ä¼šæœ‰è§¦åº•äº‹ä»¶ï¼Œæ‰€ä»¥æˆ‘å°†è¿™å—é€»è¾‘æŠ½ç¦»æˆ `mixin`ï¼Œéœ€è¦çš„é¡µé¢å¼•å…¥ä½¿ç”¨å³å¯ã€‚

`/mixins/reachBottom.js` :

```js
export default {
  data() {
    return {
      _scrollingElement: null,
      _isReachBottom: false,  // é˜²æ­¢è¿›å…¥æ‰§è¡ŒåŒºåŸŸæ—¶ é‡å¤è§¦å‘
      reachBottomDistance: 80 // è·ç¦»åº•éƒ¨å¤šè¿œè§¦å‘
    }
  },
  mounted() {
    this._scrollingElement = document.scrollingElement
    window.addEventListener('scroll', this._windowScrollHandler)
  },
  beforeDestroy() {
    window.removeEventListener('scroll', this._windowScrollHandler)
  },
  methods: {
    _windowScrollHandler() {
      let scrollHeight = this._scrollingElement.scrollHeight
      let currentHeight = this._scrollingElement.scrollTop + this._scrollingElement.clientHeight + this.reachBottomDistance
      if (currentHeight < scrollHeight && this._isReachBottom) {
        this._isReachBottom = false
      }
      if (this._isReachBottom) {
        return
      }
      // è§¦åº•äº‹ä»¶è§¦å‘
      if (currentHeight >= scrollHeight) {
        this._isReachBottom = true
        typeof this.reachBottom === 'function' && this.reachBottom()
      }
    }
  },
}
```

å®ç°çš„æ ¸å¿ƒå½“ç„¶æ˜¯è§¦å‘æ—¶æœº: `scrollTop`ï¼ˆé¡µé¢æ»šåŠ¨è·ç¦»ï¼‰+ `clientHeight`ï¼ˆé¡µé¢å¯è§†é«˜åº¦ï¼‰>= `scrollHeight`ï¼ˆé¡µé¢æ€»é«˜åº¦ï¼ŒåŒ…æ‹¬æ»šåŠ¨åŒºåŸŸï¼‰ã€‚ä½†è¿™ç§éœ€è¦å®Œå…¨è§¦åº•æ‰èƒ½è§¦å‘äº‹ä»¶ï¼Œæ‰€ä»¥åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæˆ‘æ·»åŠ  `reachBottomDistance` ç”¨äºæ§åˆ¶è§¦å‘äº‹ä»¶çš„è·ç¦»ã€‚æœ€ç»ˆï¼Œè§¦å‘äº‹ä»¶ä¼šè°ƒç”¨é¡µé¢ `methods` çš„ `reachBottom` æ–¹æ³•ã€‚

### å‘½ä»¤å¼å¼¹çª—ç»„ä»¶

å‘½ä»¤å¼ç»„ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ `element-UI` çš„ `Message` ç»„ä»¶å°±æ˜¯å¾ˆå¥½çš„ä¾‹å­ï¼Œå½“æˆ‘ä»¬éœ€è¦å¼¹çª—æç¤ºæ—¶ï¼Œåªéœ€è¦è°ƒç”¨ä¸€ä¸‹ `this.message()`ï¼Œè€Œä¸æ˜¯é€šè¿‡ `v-if` åˆ‡æ¢ç»„ä»¶ã€‚è¿™ç§çš„å¥½å¤„å°±æ˜¯ä¸ç”¨å¼•å…¥ç»„ä»¶ï¼Œä½¿ç”¨èµ·æ¥ä¾¿æ·ï¼Œå“ªé‡Œéœ€è¦è°ƒå“ªé‡Œã€‚

`nuxt-juejin-project` é¡¹ç›®ä¸­æˆ‘ä¹Ÿå°è£…äº†ä¸¤ä¸ªå…¬ç”¨çš„å¼¹çª—ç»„ä»¶ï¼Œç™»å½•å¼¹çª—å’Œé¢„è§ˆå¤§å›¾å¼¹çª—ï¼ŒæŠ€æœ¯ç‚¹æ˜¯æ‰‹åŠ¨æŒ‚è½½ç»„ä»¶ã€‚å®ç°ä»£ç å¹¶ä¸å¤šï¼Œå‡ è¡Œè¶³çŸ£ã€‚

#### å®šä¹‰

`/components/common/picturesModal/picturesModal.vue` :

```js
export default {
  data() {
    return {
      url: '',  // å½“å‰å›¾ç‰‡é“¾æ¥
      urls: ''  // å›¾ç‰‡é“¾æ¥æ•°ç»„
    }
  },
  methods: {
    show(cb) {
      this.cb = cb
      return new Promise((resolve, reject) => {
        document.body.style.overflow = 'hidden'
        this.resolve = resolve
        this.reject = reject
      })
    },
    // é”€æ¯å¼¹çª—
    hideModal() {
      typeof this.cb === 'function' && this.cb()
      document.body.removeChild(this.$el)
      document.body.style.overflow = ''
      // é”€æ¯ç»„ä»¶å®ä¾‹
      this.$destroy()
    },
    // å…³é—­å¼¹çª—
    cancel() {
      this.reject()
      this.hideModal()
    },
  }
}
```

`/components/common/picturesModal/index.js`

```js
import Vue from 'vue'
import picturesModal from './picturesModal'

let componentInstance = null

// æ„é€ å­ç±»
let ModalConstructor = Vue.extend(picturesModal)

function createModal(options) {
  // å®ä¾‹åŒ–ç»„ä»¶
  componentInstance = new ModalConstructor()
  // åˆå¹¶é€‰é¡¹
  Object.assign(componentInstance, options)
  // $mountå¯ä»¥ä¼ å…¥é€‰æ‹©å™¨å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæŒ‚è½½åˆ°è¯¥é€‰æ‹©å™¨
  // å¦‚æœä¸ä¼ å…¥é€‰æ‹©å™¨ï¼Œå°†æ¸²æŸ“ä¸ºæ–‡æ¡£ä¹‹å¤–çš„çš„å…ƒç´ ï¼Œä½ å¯ä»¥æƒ³è±¡æˆ document.createElement()åœ¨å†…å­˜ä¸­ç”Ÿæˆdom
  // $elè·å–çš„æ˜¯domå…ƒç´ 
  document.body.appendChild(componentInstance.$mount().$el)
}

function caller (options) {
  // å•ä¾‹ å…¨å±€åªå­˜åœ¨ä¸€ä¸ªå¼¹çª—
  if (!componentInstance) {
    createModal(options)
    // è°ƒç”¨ç»„ä»¶å†…çš„showæ–¹æ³• ä¼ å…¥çš„callbackåœ¨ç»„ä»¶é”€æ¯æ—¶è°ƒç”¨
    return componentInstance.show(() => { componentInstance = null })
  }
}

export default {
  install(Vue) {
    // æ³¨å†Œè°ƒèµ·å¼¹çª—æ–¹æ³•ï¼Œæ–¹æ³•è¿”å›Promise  thenä¸ºç™»å½•æˆåŠŸ  catchä¸ºå…³é—­å¼¹çª—
    Vue.prototype.$picturesModal = caller
  }
}
```

#### ä½¿ç”¨

`/plugins/vue-global.js`ï¼š

```js
import picturesModal from '~/components/common/picturesModal'

Vue.use(picturesModal)
```

è¿™é‡Œä¼ å…¥çš„å¯¹è±¡ï¼Œå°±æ˜¯ä¸Šé¢ `createModal` æ¥æ”¶åˆ°çš„ `options` å‚æ•°ï¼Œæœ€ååˆå¹¶è¦†ç›–åˆ°ç»„ä»¶çš„ `data`ã€‚

```js
this.$picturesModal({
  url: 'b.jpg'
  urls: ['a.jpg', 'b.jpg', 'c.jpg']
})
```

![](https://s1.ax1x.com/2020/05/16/Y6AgoV.gif)

## ä¸­é—´å±‚æŠ€æœ¯ç‚¹

ä¸­é—´å±‚å·¥ä½œçš„å¤§æ¦‚æµç¨‹æ˜¯åœ¨å‰ç«¯å‘é€è¯·æ±‚åˆ°ä¸­é—´å±‚ï¼Œä¸­é—´å±‚åœ¨å‘é€è¯·æ±‚åˆ°åç«¯è·å–æ•°æ®ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯åœ¨å‰ç«¯åˆ°åç«¯çš„äº¤äº’è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç›¸å½“äºè·å¾—äº†ä»£ç†çš„æ§åˆ¶æƒã€‚åˆ©ç”¨è¿™ä¸€æƒåˆ©ï¼Œæˆ‘ä»¬èƒ½åšçš„äº‹æƒ…å°±æ›´å¤šã€‚æ¯”å¦‚ï¼š

* ä»£ç†ï¼šåœ¨å¼€å‘ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä»£ç†æ¥ï¼Œè§£å†³æœ€å¸¸è§çš„è·¨åŸŸé—®é¢˜ï¼›åœ¨çº¿ä¸Šç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä»£ç†ï¼Œè½¬å‘è¯·æ±‚åˆ°å¤šä¸ªæœåŠ¡ç«¯ã€‚
* ç¼“å­˜ï¼šç¼“å­˜å…¶å®æ˜¯æ›´é è¿‘å‰ç«¯çš„éœ€æ±‚ï¼Œç”¨æˆ·çš„åŠ¨ä½œè§¦å‘æ•°æ®çš„æ›´æ–°ï¼Œnodeä¸­é—´å±‚å¯ä»¥ç›´æ¥å¤„ç†ä¸€éƒ¨åˆ†ç¼“å­˜éœ€æ±‚ã€‚
* æ—¥å¿—ï¼šç›¸æ¯”å…¶ä»–æœåŠ¡ç«¯è¯­è¨€ï¼Œnodeä¸­é—´å±‚çš„æ—¥å¿—è®°å½•ï¼Œèƒ½æ›´æ–¹ä¾¿å¿«æ·çš„å®šä½é—®é¢˜ã€‚
* ç›‘æ§ï¼šæ“…é•¿é«˜å¹¶å‘çš„è¯·æ±‚å¤„ç†ï¼Œåšç›‘æ§ä¹Ÿæ˜¯åˆé€‚çš„é€‰é¡¹ã€‚
* æ•°æ®å¤„ç†ï¼šè¿”å›æ‰€éœ€çš„æ•°æ®ï¼Œæ•°æ®å­—æ®µåˆ«åï¼Œæ•°æ®èšåˆã€‚

ä¸­é—´å±‚çš„å­˜åœ¨ä¹Ÿè®©å‰åç«¯èŒè´£åˆ†ç¦»çš„æ›´åŠ å½»åº•ï¼Œåç«¯åªéœ€è¦ç®¡ç†æ•°æ®å’Œç¼–å†™æ¥å£ï¼Œéœ€è¦å“ªäº›æ•°æ®éƒ½äº¤ç»™ä¸­é—´å±‚å»å¤„ç†ã€‚

`nuxt-juejin-project` é¡¹ç›®ä¸­é—´å±‚ä½¿ç”¨çš„æ˜¯ `koa` æ¡†æ¶ï¼Œä¸­é—´å±‚çš„ `http` è¯·æ±‚æ–¹æ³•æ˜¯åŸºäº `request` åº“ç®€å•å°è£…ä¸€ä¸‹ï¼Œä»£ç å®ç°åœ¨ `/server/request/index.js`ã€‚å› ä¸ºåé¢éœ€è¦ç”¨åˆ°ï¼Œè¿™é‡Œå°±æä¸€ä¸‹ã€‚

### è¯·æ±‚è½¬å‘

#### å®‰è£…ç›¸å…³ä¸­é—´ä»¶

```bash
npm i koa-router koa-bodyparser --save
```

**koa-router**: è·¯ç”±å™¨ä¸­é—´ä»¶ï¼Œèƒ½å¿«é€Ÿçš„å®šä¹‰è·¯ç”±ä»¥åŠç®¡ç†è·¯ç”±

**koa-bodyparser**: å‚æ•°è§£æä¸­é—´ä»¶ï¼Œæ”¯æŒè§£æ jsonã€è¡¨å•ç±»å‹ï¼Œå¸¸ç”¨äºè§£æ POST è¯·æ±‚

ç›¸å…³ä¸­é—´ä»¶çš„ä½¿ç”¨æ–¹æ³•åœ¨ `npm` ä¸Šæœç´¢ï¼Œè¿™é‡Œå°±èµ˜è¿°æ€ä¹ˆä½¿ç”¨äº†

#### è·¯ç”±è®¾è®¡

æ­£æ‰€è°“æ— è§„çŸ©ä¸æˆæ–¹åœ†ï¼Œè·¯ç”±è®¾è®¡çš„è§„èŒƒï¼Œæˆ‘å‚è€ƒçš„æ˜¯é˜®ä¸€å³°è€å¸ˆçš„ [RESTful API è®¾è®¡æŒ‡å—](http://www.ruanyifeng.com/blog/2014/05/restful_api.html)ã€‚

##### è·¯ç”±ç›®å½•

è·¯ç”±æ–‡ä»¶æˆ‘ä¼šå­˜æ”¾åœ¨ `/server/routes` ç›®å½•ä¸­ï¼ŒæŒ‰ç…§è§„èŒƒè¿˜éœ€è¦ä¸€ä¸ªè§„å®š `api` ç‰ˆæœ¬å·çš„æ–‡ä»¶å¤¹ã€‚æœ€ç»ˆè·¯ç”±æ–‡ä»¶å­˜æ”¾åœ¨ `/server/routes/v1` ä¸­ã€‚

##### è·¯ç”±è·¯å¾„

> åœ¨ RESTful æ¶æ„ä¸­ï¼Œæ¯ä¸ªç½‘å€ä»£è¡¨ä¸€ç§èµ„æºï¼ˆresourceï¼‰ï¼Œæ‰€ä»¥ç½‘å€ä¸­ä¸èƒ½æœ‰åŠ¨è¯ï¼Œåªèƒ½æœ‰åè¯ï¼Œè€Œä¸”æ‰€ç”¨çš„åè¯å¾€å¾€ä¸æ•°æ®åº“çš„è¡¨æ ¼åå¯¹åº”ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ•°æ®åº“ä¸­çš„è¡¨éƒ½æ˜¯åŒç§è®°å½•çš„"é›†åˆ"ï¼ˆcollectionï¼‰ï¼Œæ‰€ä»¥ API ä¸­çš„åè¯ä¹Ÿåº”è¯¥ä½¿ç”¨å¤æ•°ã€‚

ä¾‹å¦‚ï¼š

* æ–‡ç« ç›¸å…³æ¥å£æ–‡ä»¶å‘½åä¸º `articles`
* æ ‡ç­¾ç›¸å…³æ¥å£æ–‡ä»¶å‘½åä¸º `tag`
* æ²¸ç‚¹ç›¸å…³æ¥å£æ–‡ä»¶å‘½åä¸º `pins`

##### è·¯ç”±ç±»å‹

è·¯ç”±æ“ä½œèµ„æºçš„å…·ä½“ç±»å‹ï¼Œç”± `HTTP` åŠ¨è¯è¡¨ç¤º

* GETï¼ˆSELECTï¼‰ï¼šä»æœåŠ¡å™¨å–å‡ºèµ„æºï¼ˆä¸€é¡¹æˆ–å¤šé¡¹ï¼‰ã€‚
* POSTï¼ˆCREATEï¼‰ï¼šåœ¨æœåŠ¡å™¨æ–°å»ºä¸€ä¸ªèµ„æºã€‚
* PUTï¼ˆUPDATEï¼‰ï¼šåœ¨æœåŠ¡å™¨æ›´æ–°èµ„æºï¼ˆå®¢æˆ·ç«¯æä¾›æ”¹å˜åçš„å®Œæ•´èµ„æºï¼‰ã€‚
* DELETEï¼ˆDELETEï¼‰ï¼šä»æœåŠ¡å™¨åˆ é™¤èµ„æºã€‚

#### è·¯ç”±é€»è¾‘

ä¸‹é¢æ˜¯ç”¨æˆ·ä¸“æ åˆ—è¡¨æ¥å£çš„ä¾‹å­

`/server/router/articles.js`

```js
const Router = require('koa-router')
const router = new Router()
const request = require('../../request')
const { toObject } = require('../../../utils')

/**
 * è·å–ç”¨æˆ·ä¸“æ æ–‡ç« 
 * @param {string} targetUid - ç”¨æˆ·id
 * @param {string} before - æœ€åä¸€æ¡çš„createdAtï¼Œä¸‹ä¸€é¡µä¼ å…¥
 * @param {number} limit - æ¡æ•°
 * @param {string} order - rankIndexï¼šçƒ­é—¨ã€createdAtï¼šæœ€æ–°
 */
router.get('/userPost', async (ctx, next) => {
  // å¤´éƒ¨ä¿¡æ¯
  const headers = ctx.headers
  const options = {
    url: 'https://timeline-merger-ms.juejin.im/v1/get_entry_by_self',
    method: "GET",
    params: {
      src: "web",
      uid: headers['x-uid'],
      device_id: headers['x-device-id'],
      token: headers['x-token'],
      targetUid: ctx.query.targetUid,
      type: ctx.query.type || 'post',
      limit: ctx.query.limit || 20,
      before: ctx.query.before,
      order: ctx.query.order || 'createdAt'
    }
  };
  // å‘èµ·è¯·æ±‚
  let { body } = await request(options)
  // è¯·æ±‚åè·å–åˆ°çš„æ•°æ®ä¸º jsonï¼Œéœ€è¦è½¬ä¸º object è¿›è¡Œæ“ä½œ
  body = toObject(body)
  ctx.body = {
    s: body.s,
    d: body.d.entrylist || []
  }
})

module.exports = router
```

#### æ³¨å†Œè·¯ç”±

`/server/index.js` æ˜¯ `Nuxt.js` ä¸ºæˆ‘ä»¬ç”Ÿæˆå¥½çš„æœåŠ¡ç«¯çš„å…¥å£æ–‡ä»¶ï¼Œæˆ‘ä»¬çš„ä¸­é—´ä»¶ä½¿ç”¨å’Œè·¯ç”±æ³¨å†Œéƒ½éœ€è¦åœ¨è¿™ä¸ªæ–‡ä»¶å†…ç¼–å†™ã€‚ä¸‹é¢çš„åº”ç”¨ä¼šå¿½ç•¥éƒ¨åˆ†ä»£ç ï¼Œåªå±•ç¤ºä¸»è¦çš„é€»è¾‘ã€‚

`/server/index.js` :

```js
const Koa = require('koa')
const Router = require('koa-router')
const bodyParser = require('koa-bodyparser')
const app = new Koa()
const router = new Router()

// ä½¿ç”¨ä¸­é—´ä»¶
function useMiddleware(){
  app.use(bodyParser())
}

// æ³¨å†Œè·¯ç”±
function useRouter(){
  let module = require('./routes/articles')
  router.use('/v1/articles', module.routes())
  app.use(router.routes()).use(router.allowedMethods())
}

function start () {
  useMiddleware()
  useRouter()
  app.listen(8000, '127.0.0.1')
}

start()
```

æœ€åæ¥å£çš„è°ƒç”¨åœ°å€æ˜¯ï¼š [http://127.0.0.1:8000/v1/articles/userPost](http://127.0.0.1:8000/v1/articles/userPost)

### è·¯ç”±è‡ªåŠ¨åŒ–æ³¨å†Œ

æ²¡é”™ï¼Œå®ƒåˆæ¥äº†ã€‚è‡ªåŠ¨åŒ–å°±æ˜¯é¦™ï¼Œä¸€åŠ³æ°¸é€¸èƒ½ä¸é¦™å—ã€‚

```js
const fs = require('fs')
const Koa = require('koa')
const Router = require('koa-router')
const bodyParser = require('koa-bodyparser')
const app = new Koa()
const router = new Router()

// æ³¨å†Œè·¯ç”±
function useRouter(path){
  path = path || __dirname + '/routes'
  // è·å– routes ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åï¼Œurlsä¸ºæ–‡ä»¶åæ•°ç»„
  let urls = fs.readdirSync(path)
  urls.forEach((element) => {
    const elementPath = path + '/' + element
    const stat = fs.lstatSync(elementPath);
    // æ˜¯å¦ä¸ºæ–‡ä»¶å¤¹
    const isDir = stat.isDirectory();
    // æ–‡ä»¶å¤¹é€’å½’æ³¨å†Œè·¯ç”±
    if (isDir) {
      useRouter(elementPath)
    } else {
      let module = require(elementPath)
      let routeRrefix = path.split('/routes')[1] || ''
      //routesé‡Œçš„æ–‡ä»¶åä½œä¸º è·¯ç”±å
      router.use(routeRrefix + '/' + element.replace('.js', ''), module.routes())
    }
  })
  //ä½¿ç”¨è·¯ç”±
  app.use(router.routes()).use(router.allowedMethods())
}

function start () {
  useMiddleware()
  useRouter()
  app.listen(8000, '127.0.0.1')
}

start()
```

ä¸Šé¢çš„ä»£ç ä»¥ `routes` ä½œä¸ºè·¯ç”±çš„ä¸»ç›®å½•ï¼Œå‘ä¸‹å¯»æ‰¾ `js` æ–‡ä»¶æ³¨å†Œè·¯ç”±ï¼Œæœ€ç»ˆä»¥ `js` æ–‡ä»¶è·¯å¾„ä½œä¸ºè·¯ç”±åã€‚ä¾‹å¦‚ï¼Œ `/server/routes/v1/articles.js` ä¸­æœ‰ä¸ªæœç´¢æ¥å£ `/search`ï¼Œé‚£ä¹ˆè¯¥æ¥å£çš„è°ƒç”¨åœ°å€ä¸º `localhost:8000/v1/articles/search`ã€‚

### è·¯ç”±å‚æ•°éªŒè¯

å‚æ•°éªŒè¯æ˜¯æ¥å£ä¸­ä¸€å®šä¼šæœ‰çš„åŠŸèƒ½ï¼Œä¸æ­£ç¡®çš„å‚æ•°ä¼šå¯¼è‡´ç¨‹åºæ„å¤–é”™è¯¯ã€‚æˆ‘ä»¬åº”è¯¥æå‰å¯¹å‚æ•°éªŒè¯ï¼Œä¸­æ­¢é”™è¯¯çš„æŸ¥è¯¢å¹¶å‘ŠçŸ¥ä½¿ç”¨è€…ã€‚é¡¹ç›®ä¸­æˆ‘åŸºäº `async-validator` å°è£…äº†ä¸€ä¸ªè·¯ç”±ä¸­é—´ä»¶æ¥éªŒè¯å‚æ•°ã€‚å¦‚æœä½ ä¸çŸ¥é“ `koa` ä¸­é—´ä»¶çš„å·¥ä½œæµç¨‹ï¼Œé‚£æœ‰å¿…è¦å»äº†è§£ä¸‹æ´‹è‘±æ¨¡å‹ã€‚

#### å®šä¹‰

`/server/middleware/validator/js` :

```js
const { default: Schema } = require('async-validator')

module.exports = function (descriptor) {
  return async function (ctx, next) {
    let validator = new Schema(descriptor)
    let params = {}
    // è·å–å‚æ•°
    Object.keys(descriptor).forEach(key => {
      if (ctx.method === 'GET') {
        params[key] = ctx.query[key]
      } else if (
        ctx.method === 'POST' ||
        ctx.method === 'PUT' ||
        ctx.method === 'DELETE'
      ) {
        params[key] = ctx.request.body[key]
      }
    })
    // éªŒè¯å‚æ•°
    const errors = await validator.validate(params)
      .then(() => null)
      .catch(err => err.errors)
    // å¦‚æœéªŒè¯ä¸é€šè¿‡ åˆ™è¿”å›é”™è¯¯
    if (errors) {
      ctx.body = {
        s: 0,
        errors
      }
    } else {
      await next()
    }
  }
}
```

#### ä½¿ç”¨

ä½¿ç”¨æ–¹æ³•è¯·å‚è€ƒ [async-validator](https://www.npmjs.com/package/async-validator)

```js
const Router = require('koa-router')
const router = new Router()
const request = require('../../request')
const validator = require('../../middleware/validator')
const { toObject } = require('../../../utils')

/**
 * è·å–ç”¨æˆ·ä¸“æ æ–‡ç« 
 * @param {string} targetUid - ç”¨æˆ·id
 * @param {string} before - æœ€åä¸€æ¡çš„createdAtï¼Œä¸‹ä¸€é¡µä¼ å…¥
 * @param {number} limit - æ¡æ•°
 * @param {string} order - rankIndexï¼šçƒ­é—¨ã€createdAtï¼šæœ€æ–°
 */
router.get('/userPost', validator({
  targetUid: { type: 'string', required: true },
  before: { type: 'string' },
  limit: {
    type: 'string',
    required: true,
    validator: (rule, value) => Number(value) > 0,
    message: 'limit éœ€ä¼ å…¥æ­£æ•´æ•°'
  },
  order: { type: 'enum', enum: ['rankIndex', 'createdAt'] }
}), async (ctx, next) => {
  const headers = ctx.headers
  const options = {
    url: 'https://timeline-merger-ms.juejin.im/v1/get_entry_by_self',
    method: "GET",
    params: {
      src: "web",
      uid: headers['x-uid'],
      device_id: headers['x-device-id'],
      token: headers['x-token'],
      targetUid: ctx.query.targetUid,
      type: ctx.query.type || 'post',
      limit: ctx.query.limit || 20,
      before: ctx.query.before,
      order: ctx.query.order || 'createdAt'
    }
  };
  let { body } = await request(options)
  body = toObject(body)
  ctx.body = {
    s: body.s,
    d: body.d.entrylist || []
  }
})

module.exports = router
```

`type`ä»£è¡¨å‚æ•°ç±»å‹ï¼Œ `required`ä»£è¡¨æ˜¯å¦å¿…å¡«ã€‚å½“ `type` ä¸º `enum`ï¼ˆæšä¸¾ï¼‰ç±»å‹æ—¶ï¼Œå‚æ•°å€¼åªèƒ½ä¸º `enum` æ•°ç»„ä¸­çš„æŸä¸€é¡¹ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ `number` ç±»å‹åœ¨è¿™é‡Œæ˜¯æ— æ³•éªŒè¯çš„ï¼Œå› ä¸ºå‚æ•°åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¼šè¢«è½¬å˜ä¸ºå­—ç¬¦ä¸²ç±»å‹ã€‚ä½†æ˜¯æˆ‘ä»¬èƒ½é€šè¿‡ `validator` æ–¹æ³•è‡ªå®šä¹‰éªŒè¯è§„åˆ™ï¼Œå°±åƒä¸Šé¢çš„ `limit` å‚æ•°ã€‚

ä»¥ä¸‹æ˜¯å½“ `limit` å‚æ•°é”™è¯¯æ—¶æ¥å£è¿”å›çš„å†…å®¹ï¼š

![](https://s1.ax1x.com/2020/05/16/Yy6vJ1.png)

### ç½‘ç«™å®‰å…¨æ€§

#### cors

è®¾ç½® `cors` æ¥éªŒè¯è¯·æ±‚çš„å®‰å…¨åˆæ³•æ€§ï¼Œå¯ä»¥è®©ä½ çš„ç½‘ç«™æé«˜å®‰å…¨æ€§ã€‚å€ŸåŠ© `koa2-cors` èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ›´ä¾¿æ·çš„åšåˆ°è¿™äº›ã€‚ `koa2-cors` çš„æºç ä¹Ÿä¸å¤šï¼Œå»ºè®®å»çœ‹çœ‹ï¼Œåªè¦ä½ æœ‰ç‚¹åŸºç¡€éƒ½èƒ½çœ‹æ‡‚ï¼Œä¸ä»…è¦æ‡‚å¾—ç”¨ä¹Ÿè¦çŸ¥é“å®ç°è¿‡ç¨‹ã€‚

##### å®‰è£…

```bash
npm install koa2-cors --save
```

##### ä½¿ç”¨

`/server/index.js` :

```js
const cors = require('koa2-cors')

function useMiddleware(){
  app.use(helmet())
  app.use(bodyParser())
  //è®¾ç½®å…¨å±€è¿”å›å¤´
  app.use(cors({
    // å…è®¸è·¨åŸŸçš„åŸŸå
    origin: function(ctx) {
      return 'http://localhost:8000';
    },
    exposeHeaders: ['WWW-Authenticate', 'Server-Authorization'],
    maxAge: 86400,
    // å…è®¸æºå¸¦å¤´éƒ¨éªŒè¯ä¿¡æ¯
    credentials: true,
    // å…è®¸çš„æ–¹æ³•
    allowMethods: ['GET', 'POST', 'PUT', 'DELETE', 'HEAD', 'OPTIONS'],
    // å…è®¸çš„æ ‡å¤´
    allowHeaders: ['Content-Type', 'Authorization', 'Accept', 'X-Token', 'X-Device-Id', 'X-Uid'],
  }))
}
```

å¦‚æœä¸ç¬¦åˆè¯·æ±‚çš„æ–¹å¼ï¼Œæˆ–å¸¦æœ‰æœªå…è®¸çš„æ ‡å¤´ã€‚å‘é€è¯·æ±‚æ—¶ä¼šç›´æ¥å¤±è´¥ï¼Œæµè§ˆå™¨æŠ›å‡º `cors` ç­–ç•¥é™åˆ¶çš„é”™è¯¯ã€‚ä¸‹é¢æ˜¯å¸¦æœ‰æœªå…è®¸æ ‡å¤´é”™è¯¯çš„ä¾‹å­ï¼š

![](https://s1.ax1x.com/2020/05/15/YyBCL9.png)

#### koa-helmet

`koa-helmet` æä¾›é‡è¦çš„å®‰å…¨æ ‡å¤´ï¼Œä½¿ä½ çš„åº”ç”¨ç¨‹åºåœ¨é»˜è®¤æƒ…å†µä¸‹æ›´åŠ å®‰å…¨ã€‚

##### å®‰è£…

```bash
npm install koa-helmet --save
```

##### ä½¿ç”¨

```js
const helmet = require('koa-helmet')

function useMiddleware(){
  app.use(helmet())
  // .....

}
```

é»˜è®¤ä¸ºæˆ‘ä»¬åšäº†ä»¥ä¸‹å®‰å…¨è®¾ç½®ï¼š

* X-DNS-Prefetch-Control: ç¦ç”¨æµè§ˆå™¨çš„ `DNS` é¢„å–ã€‚
* X-Frame-Options: ç¼“è§£ç‚¹å‡»åŠ«æŒæ”»å‡»ã€‚
* X-Powered-Byï¼šåˆ é™¤äº† `X-Powered-By` æ ‡å¤´ï¼Œä½¿æ”»å‡»è€…æ›´éš¾äºæŸ¥çœ‹ä½¿ç½‘ç«™å—åˆ°æ½œåœ¨å¨èƒçš„æŠ€æœ¯ã€‚
* Strict-Transport-Securityï¼šä½¿æ‚¨çš„ç”¨æˆ·ä½¿ç”¨ `HTTPS`ã€‚
* X-Download-Optionsï¼šé˜²æ­¢ `Internet Explorer` åœ¨æ‚¨çš„ç«™ç‚¹ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œä¸‹è½½ã€‚
* X-Content-Type-Optionsï¼š è®¾ç½®ä¸º `nosniff`ï¼Œæœ‰åŠ©äºé˜²æ­¢æµè§ˆå™¨è¯•å›¾çŒœæµ‹ï¼ˆ"å—…æ¢"ï¼‰ `MIME` ç±»å‹ï¼Œè¿™å¯èƒ½ä¼šå¸¦æ¥å®‰å…¨éšæ‚£ã€‚
* X-XSS-Protectionï¼šé˜²æ­¢åå°„çš„ `XSS` æ”»å‡»ã€‚

![](https://s1.ax1x.com/2020/05/15/YyBNQg.png)

æ›´å¤šè¯´æ˜å’Œé…ç½®æˆ³è¿™é‡Œ [https://www.npmjs.com/package/koa-helmet](https://www.npmjs.com/package/koa-helmet)

## æœ€å

æ„Ÿè§‰ä¸­é—´å±‚çš„ç›¸å…³çŸ¥è¯†ç‚¹è¿˜æ˜¯ä¸å¤Ÿå…¨ï¼Œèƒ½åšçš„è¿˜æœ‰å¾ˆå¤šï¼Œè¿˜æ˜¯å¾—ç»§ç»­å­¦ä¹ ã€‚é¡¹ç›®åç»­è¿˜ä¼šæ›´æ–°ä¸€æ®µæ—¶é—´ï¼Œæ›´å¤šä¼šé è¿‘æœåŠ¡ç«¯è¿™å—ï¼Œæ¯”å¦‚ç¼“å­˜ä¼˜åŒ–ã€å¼‚å¸¸æ•è·è¿™ç±»çš„ã€‚

å¦‚æœä½ æœ‰ä»»ä½•å»ºè®®æˆ–æ”¹è¿›ï¼Œè¯·å‘Šè¯‰æˆ‘~

ğŸ˜„çœ‹åˆ°è¿™é‡Œè¿˜ä¸æ¥ä¸ªå°æ˜Ÿæ˜Ÿå—ï¼Ÿ [https://github.com/ChanWahFung/nuxt-juejin-project](https://github.com/ChanWahFung/nuxt-juejin-project)

## å‚è€ƒèµ„æ–™

* å…¶å®ƒå¸¸è§é—®é¢˜ï¼š[https://www.nuxtjs.cn/faq](https://www.nuxtjs.cn/faq)
* å®˜æ–¹githubæ–‡æ¡£ï¼š[https://github.com/nuxt/docs/tree/master/zh](https://github.com/nuxt/docs/tree/master/zh)ï¼ˆé‡Œé¢æœ‰å…¨é¢é…ç½®å’Œä¾‹å­ä½¿ç”¨ï¼Œéƒ¨åˆ†åœ¨ Nuxt.js æ–‡æ¡£ä¸­æ²¡æœ‰æåŠï¼Œå¾ˆå»ºè®®çœ‹ä¸‹ï¼‰